(function(){var active_item_clone,board_palette_dom,color_palette_dom,copy_outline,create_clone,dom,game_dom,i,icon_class,init_handlers,item_click_handler,k,key,len,outline_dom,outline_hidden_dom,outline_table,outlines_dom,palette_dom,ref,remove_data,selected,selected_outline,set_data,snap_targets;selected_outline=null;selected={color_icon:null,board_item:null};outlines_dom=[...document.querySelectorAll("#outlines > .outline-container")];outline_dom=document.querySelector("#outline > .outline-container");game_dom=document.querySelector("#game-container");outline_hidden_dom=document.querySelector("#outline-hidden > .outline-container");color_palette_dom=document.getElementById("color-palette");board_palette_dom=document.getElementById("board-palette");copy_outline=function(src,target,erase_data=false){var i,j,k,l,ref,ref1,src_cell,src_table,target_cell,target_table;target.setAttribute("data-index",src.getAttribute("data-index"));src_table=src.querySelector("table");target_table=target.querySelector("table");for(i=k=0,ref=src_table.rows.length;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k){for(j=l=0,ref1=src_table.rows[0].cells.length;0<=ref1?l<ref1:l>ref1;j=0<=ref1?++l:--l){target_cell=target_table.rows[i].cells[j];src_cell=src_table.rows[i].cells[j];target_cell.setAttribute("data-value",src_cell.getAttribute("data-value"));if(erase_data){remove_data(target_cell,color_palette_dom,"color-icon","color_icon")}}}return target.querySelector(".outline-grid").innerHTML=src.querySelector(".outline-grid").innerHTML};outlines_dom.forEach(function(outline){return outline.addEventListener("click",function(){if(selected_outline){selected_outline.classList.remove("selected");if(selected_outline===this){copy_outline(outline_hidden_dom,outline_dom,true);copy_outline(outline_hidden_dom,game_dom);selected_outline=null;return}}this.classList.add("selected");selected_outline=this;copy_outline(selected_outline,outline_dom,true);return copy_outline(selected_outline,game_dom)})});item_click_handler=function(property){if(selected[property]){selected[property].classList.remove("selected");if(selected[property]===this){selected[property]=null;return}}this.classList.add("selected");return selected[property]=this};remove_data=function(cell,palette,icon_class,key){var color_class,span;color_class=cell.getAttribute("data-class");if(color_class){cell.classList.remove(color_class);palette.querySelector(`.${color_class}`).style.display="flex"}cell.removeAttribute("data-class");cell.removeAttribute("data-index");cell.removeAttribute("data-name");span=cell.querySelector("span");if(span){return span.innerHTML=""}};set_data=function(cell,klass,index,name){var cell_color_class;cell_color_class=cell.getAttribute("data-class");if(cell_color_class){cell.classList.remove(cell_color_class)}cell.classList.add(klass);cell.setAttribute("data-class",klass);cell.setAttribute("data-index",index);cell.setAttribute("data-name",name);if(name){return cell.querySelector("span").innerHTML=name}};init_handlers=function(key,icon_class,dom,palette_dom){var item,k,len,ref;if(key==="color_icon"){ref=palette_dom.getElementsByClassName(icon_class);for(k=0,len=ref.length;k<len;k++){item=ref[k];item.addEventListener("click",function(){return item_click_handler.call(this,key)})}}return dom.querySelectorAll("td").forEach(function(cell){return cell.addEventListener("click",function(){var cell_color_class,index,klass,name,selected_value,value;value=cell.getAttribute("data-value");selected_value=selected[key];if(selected_value){cell_color_class=cell.getAttribute("data-class");if(cell_color_class){palette_dom.querySelector(`.${cell_color_class}`).style.display="flex"}klass=selected_value.getAttribute("data-class");index=selected_value.getAttribute("data-index");name=selected_value.getAttribute("data-name");if(key==="color_icon"){dom.querySelectorAll(`td[data-value='${value}']`).forEach(function(c){return set_data(c,klass,index,name)})}else{set_data(cell,klass,index,name)}selected_value.classList.remove("selected");if(dom.querySelectorAll(`.${klass}`).length>=4){selected_value.style.display="none"}return selected[key]=null}else{cell_color_class=cell.getAttribute("data-class");if(cell_color_class){if(key==="color_icon"){return dom.querySelectorAll(`td[data-value='${value}']`).forEach(function(c){return remove_data(c,palette_dom,icon_class,key)})}else{return remove_data(cell,palette_dom,icon_class,key)}}}})})};ref=[["color_icon","color-icon",outline_dom,color_palette_dom],["board_item","board-item",game_dom,board_palette_dom]];for(k=0,len=ref.length;k<len;k++){[key,icon_class,dom,palette_dom]=ref[k];init_handlers(key,icon_class,dom,palette_dom)}document.querySelectorAll(".node").forEach(function(node){return node.addEventListener("click",function(){return node.classList.toggle("disabled")})});create_clone=function(source){var clone;clone=source.cloneNode(true);clone.style.position="absolute";clone.style.left=source.offsetLeft+"px";clone.style.top=source.offsetTop+"px";source.before(clone);return clone};active_item_clone=null;interact(".board-item").draggable({onstart:function(evt){return active_item_clone=create_clone(evt.target)},onmove:function(evt){var el,x,y;el=evt.target;x=(parseFloat(el.dataset.x)||0)+evt.dx;y=(parseFloat(el.dataset.y)||0)+evt.dy;el.style.transform=`translate(${x}px, ${y}px)`;el.dataset.x=x;return el.dataset.y=y},onend:function(evt){var el;el=evt.target;el.style.transform="";el.removeAttribute("data-x");el.removeAttribute("data-y");active_item_clone.remove();return active_item_clone=null}}).styleCursor(false);interact("#game-container td").dropzone({accept:".board-item",overlap:.75,ondrop:function(evt){var cell_class,el,index,klass,name,selected_value;el=evt.target;cell_class=el.getAttribute("data-class");if(cell_class){board_palette_dom.querySelector(`.${cell_class}`).style.display="flex"}selected_value=evt.relatedTarget;klass=selected_value.getAttribute("data-class");index=selected_value.getAttribute("data-index");name=selected_value.getAttribute("data-name");set_data(el,klass,index,name);if(game_dom.querySelectorAll(`.${klass}`).length>=4){return selected_value.style.display="none"}}});document.querySelectorAll(".tetramino").forEach(function(t){if(!t.parentNode.classList.contains("tet-O")){t.dataset.rotationAngle=0;return t.addEventListener("click",function(){if(t.dataset.isDragging==="true"){return t.dataset.isDragging=false}else{t.dataset.rotationAngle=parseInt(t.dataset.rotationAngle)+90;return t.style.setProperty("--rotation",`${t.dataset.rotationAngle}deg`)}})}});outline_table=document.querySelector("#outline table");snap_targets=function(index){var inner;inner=function(x,y,interaction){var cell_size,el,i,j,l,m,offsetX,offsetY,points,ref1,ref2,tableRect;el=interaction.element;console.log(x-el.style.left,y-el.style.top);cell_size=el.querySelector(".cell").getBoundingClientRect().width;tableRect=outline_table.getBoundingClientRect();console.log(tableRect);offsetY=window.pageYOffset||document.documentElement.scrollTop;offsetX=window.pageXOffset||document.documentElement.scrollLeft;points=[];for(i=l=0,ref1=outline_table.rows.length-1;0<=ref1?l<ref1:l>ref1;i=0<=ref1?++l:--l){for(j=m=0,ref2=outline_table.rows[0].cells.length-1;0<=ref2?m<ref2:m>ref2;j=0<=ref2?++m:--m){points.push({x:tableRect.left+offsetX+(j+1)*cell_size,y:tableRect.top+offsetY+(i+1)*cell_size})}}return points[index]};return inner};interact(".tetramino").draggable({onstart:function(evt){var el;el=evt.target;el.classList.remove("animate");el.dataset.isDragging=true;return active_item_clone=create_clone(el)},onmove:function(evt){var el,x,y;el=evt.target;x=(parseFloat(el.dataset.x)||0)+evt.dx;y=(parseFloat(el.dataset.y)||0)+evt.dy;el.style.transform=`translate(${x}px, ${y}px) rotate(var(--rotation, 0))`;el.dataset.x=x;return el.dataset.y=y},onend:function(evt){var el;el=evt.target;el.style.transform="rotate(var(--rotation, 0))";el.removeAttribute("data-x");el.removeAttribute("data-y");el.offsetHeight;el.classList.add("animate");active_item_clone.remove();return active_item_clone=null},modifiers:[interact.modifiers.snap({targets:function(){var l,results;if(snap_targets(i)){results=[];for(i=l=0;l<9;i=++l){results.push(snap_targets(i))}return results}}(),range:20,relativePoints:[{x:.5,y:.5}]})]}).styleCursor(false);interact("#outline table").dropzone({accept:".tetramino",overlap:.8,ondrop:function(evt){var cell,tetramino;tetramino=evt.relatedTarget;cell=evt.target;cell.parentNode.querySelector(".outline-grid").innerHTML=tetramino.querySelector(".outline-grid").innerHTML;console.log(cell.getBoundingClientRect());return console.log(tetramino.getBoundingClientRect())}})}).call(this);