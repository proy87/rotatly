(function(){var board_palette_dom,color_palette_dom,copy_outline,dom,game_dom,icon_class,init_handlers,insert_icon,item_click_handler,k,key,len,outline_dom,outline_hidden_dom,outlines_dom,palette_dom,ref,remove_data,selected,selected_outline,set_data;selected_outline=null;selected={color_icon:null,board_item:null};outlines_dom=[...document.querySelectorAll("#outlines > .outline-container")];outline_dom=document.querySelector("#outline > .outline-container");game_dom=document.querySelector("#game-container");outline_hidden_dom=document.querySelector("#outline-hidden > .outline-container");color_palette_dom=document.getElementById("color-palette");board_palette_dom=document.getElementById("board-palette");copy_outline=function(src,target,erase_data=false){var i,j,k,l,ref,ref1,src_cell,src_table,target_cell,target_table;target.setAttribute("data-index",src.getAttribute("data-index"));src_table=src.querySelector("table");target_table=target.querySelector("table");for(i=k=0,ref=src_table.rows.length;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k){for(j=l=0,ref1=src_table.rows[0].cells.length;0<=ref1?l<ref1:l>ref1;j=0<=ref1?++l:--l){target_cell=target_table.rows[i].cells[j];src_cell=src_table.rows[i].cells[j];target_cell.setAttribute("data-value",src_cell.getAttribute("data-value"));if(erase_data){remove_data(target_cell,color_palette_dom,"color-icon","color_icon")}}}return target.querySelector(".outline-grid").innerHTML=src.querySelector(".outline-grid").innerHTML};outlines_dom.forEach(function(outline){return outline.addEventListener("click",function(){if(selected_outline){selected_outline.classList.remove("selected");if(selected_outline===this){copy_outline(outline_hidden_dom,outline_dom,true);copy_outline(outline_hidden_dom,game_dom);selected_outline=null;return}}this.classList.add("selected");selected_outline=this;copy_outline(selected_outline,outline_dom,true);return copy_outline(selected_outline,game_dom)})});item_click_handler=function(property){if(selected[property]){selected[property].classList.remove("selected");if(selected[property]===this){selected[property]=null;return}}this.classList.add("selected");return selected[property]=this};insert_icon=function(color_class,index,name,palette,icon_class,key){var icon,idx,inserted,k,len,new_icon,ref;index=parseInt(index);new_icon=document.createElement("div");new_icon.classList.add(icon_class);new_icon.classList.add(color_class);new_icon.setAttribute("data-class",color_class);new_icon.setAttribute("data-index",index);new_icon.setAttribute("data-name",name);new_icon.innerHTML=name;new_icon.addEventListener("click",function(){return item_click_handler.call(this,key)});inserted=false;ref=palette.getElementsByClassName(icon_class);for(k=0,len=ref.length;k<len;k++){icon=ref[k];idx=parseInt(icon.getAttribute("data-index"));if(idx>=index){inserted=true;if(idx!==index){icon.before(new_icon)}break}}if(!inserted){return palette.appendChild(new_icon)}};remove_data=function(cell,palette,icon_class,key){var color_class,span;color_class=cell.getAttribute("data-class");if(color_class){cell.classList.remove(color_class);insert_icon(cell.getAttribute("data-class"),cell.getAttribute("data-index"),cell.getAttribute("data-name"),palette,icon_class,key)}cell.removeAttribute("data-class");cell.removeAttribute("data-index");cell.removeAttribute("data-name");span=cell.querySelector("span");if(span){return span.innerHTML=""}};set_data=function(cell,klass,index,name){var cell_color_class;cell_color_class=cell.getAttribute("data-class");if(cell_color_class){cell.classList.remove(cell_color_class)}cell.classList.add(klass);cell.setAttribute("data-class",klass);cell.setAttribute("data-index",index);cell.setAttribute("data-name",name);if(name){return cell.querySelector("span").innerHTML=name}};init_handlers=function(key,icon_class,dom,palette_dom){var item,k,len,ref;ref=palette_dom.getElementsByClassName(icon_class);for(k=0,len=ref.length;k<len;k++){item=ref[k];item.addEventListener("click",function(){return item_click_handler.call(this,key)})}return dom.querySelectorAll("td").forEach(function(cell){return cell.addEventListener("click",function(){var cell_color_class,index,klass,name,selected_value,value;value=cell.getAttribute("data-value");selected_value=selected[key];if(selected_value){cell_color_class=cell.getAttribute("data-class");if(cell_color_class){insert_icon(cell_color_class,cell.getAttribute("data-index"),cell.getAttribute("data-name"),palette_dom,icon_class,key)}klass=selected_value.getAttribute("data-class");index=selected_value.getAttribute("data-index");name=selected_value.getAttribute("data-name");if(key==="color_icon"){dom.querySelectorAll(`td[data-value='${value}']`).forEach(function(c){return set_data(c,klass,index,name)})}else{set_data(cell,klass,index,name)}if(dom.querySelectorAll(`.${klass}`).length>=4){selected_value.remove()}else{selected_value.classList.remove("selected")}return selected[key]=null}else{cell_color_class=cell.getAttribute("data-class");if(cell_color_class){if(key==="color_icon"){return dom.querySelectorAll(`td[data-value='${value}']`).forEach(function(c){return remove_data(c,palette_dom,icon_class,key)})}else{return remove_data(cell,palette_dom,icon_class,key)}}}})})};ref=[["color_icon","color-icon",outline_dom,color_palette_dom],["board_item","board-item",game_dom,board_palette_dom]];for(k=0,len=ref.length;k<len;k++){[key,icon_class,dom,palette_dom]=ref[k];init_handlers(key,icon_class,dom,palette_dom)}document.querySelectorAll(".node").forEach(function(node){return node.addEventListener("click",function(){return node.classList.toggle("disabled")})})}).call(this);