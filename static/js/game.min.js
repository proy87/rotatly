(function(){var M,N,active_nodes_dom,animate,animated,board,check,end_time,game_completed,get_cell,get_node_and_direction,get_request,hide_element,hold_duration,hold_timer,in_animation,in_demo,is_sliding,make_move,max_date,min_date,moves,moves_made_num_dom,moves_num_dom,moves_sequence_dom,one_less_move_dom,puzzle_date_dom,restart_button,rotate,set_shareable_text,shareable_text_dom,show_element,slided_cells,start_time,table,undo,undo_button,validate,visit_time;visit_time=new Date;start_time=visit_time;end_time=start_time;board=document.getElementById("game-container");table=board.querySelector("table");N=table.rows.length;M=table.rows[0].cells.length;game_completed=false;in_animation=false;animated=false;in_demo=false;moves=[];moves_made_num_dom=document.getElementById("moves-made-num");undo_button=document.getElementById("undo-move");restart_button=document.getElementById("restart-game");moves_sequence_dom=document.getElementById("moves-sequence");one_less_move_dom=document.getElementById("one-less-move");moves_num_dom=document.getElementById("moves-num");active_nodes_dom=[...document.querySelectorAll(".node.active")];shareable_text_dom=document.getElementById("shareable-text");puzzle_date_dom=document.getElementById("puzzle-date");if(puzzle_date_dom){min_date=puzzle_date_dom.getAttribute("min");max_date=puzzle_date_dom.getAttribute("max");puzzle_date_dom.addEventListener("change",function(){var value;value=this.value;if(value&&/^\d{4}-\d{2}-\d{2}$/.test(value)&&(min_date<=value&&value<=max_date)){return window.location.href=`/${value}/`}})}hold_timer=null;hold_duration=500;is_sliding=false;slided_cells=[];hide_element=function(el){var display;display=window.getComputedStyle(el,null).display;if(display!=="none"){el.setAttribute("data-display",display)}return el.style.display="none"};show_element=function(el){var display;display=window.getComputedStyle(el,null).display;if(display==="none"){return el.style.display=el.getAttribute("data-display")||"block"}};get_request=async function(url,data){var k,params,v;params=[];for(k in data){v=data[k];params.push(`${k}=${v}`)}return await fetch(url+"?"+params.join("&"))};rotate=function(row,col,cw){var a,b,bottom_left,bottom_right,c,d,top_left,top_right;top_left=document.getElementById(`cell-${row}-${col}`);top_right=document.getElementById(`cell-${row}-${col+1}`);bottom_left=document.getElementById(`cell-${row+1}-${col}`);bottom_right=document.getElementById(`cell-${row+1}-${col+1}`);a=top_left.innerHTML;b=top_right.innerHTML;c=bottom_left.innerHTML;d=bottom_right.innerHTML;top_left.innerHTML=cw?c:b;top_right.innerHTML=cw?a:d;bottom_left.innerHTML=cw?d:a;bottom_right.innerHTML=cw?b:c;a=top_left.className;b=top_right.className;c=bottom_left.className;d=bottom_right.className;top_left.className=cw?c:b;top_right.className=cw?a:d;bottom_left.className=cw?d:a;bottom_right.className=cw?b:c;a=top_left.getAttribute("data-value");b=top_right.getAttribute("data-value");c=bottom_left.getAttribute("data-value");d=bottom_right.getAttribute("data-value");top_left.setAttribute("data-value",cw?c:b);top_right.setAttribute("data-value",cw?a:d);bottom_left.setAttribute("data-value",cw?d:a);return bottom_right.setAttribute("data-value",cw?b:c)};check=function(){var col,col1,elem,elem1,index,index1,l,m,ref,ref1,ref2,row,row1,value,value1;for(index=l=0,ref=N*M;0<=ref?l<ref:l>ref;index=0<=ref?++l:--l){row=Math.floor(index/M);col=index%M;elem=document.getElementById(`cell-${row}-${col}`);value=parseInt(elem.getAttribute("data-value"));if(outline[index]<0&&value!==outline[index]){return false}for(index1=m=ref1=index+1,ref2=N*M;ref1<=ref2?m<ref2:m>ref2;index1=ref1<=ref2?++m:--m){row1=Math.floor(index1/M);col1=index1%M;elem1=document.getElementById(`cell-${row1}-${col1}`);value1=parseInt(elem1.getAttribute("data-value"));if(!(value!==value1)!==!(outline[index]!==outline[index1])){return false}}}return true};set_shareable_text=function(){var emoji,full_text,moves_made,number,rows,text;moves_made=moves.length;emoji=null;text=null;full_text=null;rows=null;number=`#${game_index}`;if(puzzle_date_dom){number+=` (${puzzle_date_dom.value})`}if(check()){rows=4;if(moves_made===moves_min_num){emoji="ðŸ§ âœ¨";text="Perfect Solve"}else if(moves_made-moves_min_num<3){emoji="ðŸ¤";text="So close!"}else{emoji="ðŸ§©";text="Solved"}full_text=`Rotatly ${number} ${emoji}\n${text}\nMoves: ${moves_made}/${moves_min_num}\n${canonical_url}`}else{rows=3;if(moves_made===0){emoji="ðŸ˜´";text="Didn't try today"}else if(moves_made<moves_max_num){rows=4;emoji="â³";text="Rotatingâ€¦"}else{emoji="ðŸ˜¤";text="This one got me"}if(rows===4){full_text=`Rotatly ${number} ${emoji}\n${text}\nMoves: ${moves_made}\n${canonical_url}`}else{full_text=`Rotatly ${number} ${emoji}\n${text}\n${canonical_url}`}}return shareable_text_dom.value=full_text};set_shareable_text();animate=function(value,row,col,cw,undo=false,demo=false,callback=null){var bl,br,cell,cells,finished,l,len,tl,tr,transition_callback;if(in_animation){return}in_animation=true;animated=true;tl=document.getElementById(`cell-${row}-${col}`);tr=document.getElementById(`cell-${row}-${col+1}`);br=document.getElementById(`cell-${row+1}-${col+1}`);bl=document.getElementById(`cell-${row+1}-${col}`);finished=0;cells=[tl,tr,br,bl];transition_callback=function(e){var block,c,l,len,len1,m,number_of_moves,solved;if(e.propertyName==="transform"){finished+=1;if(finished===cells.length){for(l=0,len=cells.length;l<len;l++){c=cells[l];c.classList.remove("animate");c.classList.add("non-animate");c.removeEventListener("transitionend",transition_callback)}tl.classList.remove(cw?"move-right":"move-down");tr.classList.remove(cw?"move-down":"move-left");br.classList.remove(cw?"move-left":"move-up");bl.classList.remove(cw?"move-up":"move-right");for(m=0,len1=cells.length;m<len1;m++){c=cells[m];c.offsetHeight}rotate(row,col,cw);if(!undo){moves.push(`${value}${cw?cw_symbol:ccw_symbol}`);moves_sequence_dom.innerHTML=moves.length?moves.join(" "):"no moves";if(!demo){undo_button.removeAttribute("disabled");restart_button.removeAttribute("disabled")}}number_of_moves=moves.length;set_shareable_text();if(number_of_moves===1&&!undo){start_time=new Date}moves_made_num_dom.innerHTML=number_of_moves;solved=check();if(!demo&&(number_of_moves>=moves_max_num||solved)){end_time=new Date;game_completed=true;active_nodes_dom.forEach(function(node){return hide_element(node)});hide_element(undo_button);if(solved){one_less_move_dom.innerHTML=number_of_moves-1;moves_num_dom.innerHTML=number_of_moves;block=document.getElementById(`${number_of_moves>moves_min_num?"non-":""}min-text`)}else{block=document.getElementById("non-solve-text")}get_request(track_url,{game_index:game_index,init_time:(start_time-visit_time)/1e3,game_time:(end_time-start_time)/1e3,moves:moves.join(""),length:number_of_moves})}in_animation=false;if(callback){return callback()}}}};for(l=0,len=cells.length;l<len;l++){cell=cells[l];cell.classList.remove("non-animate");cell.classList.add("animate");cell.addEventListener("transitionend",transition_callback)}tl.classList.add(cw?"move-right":"move-down");tr.classList.add(cw?"move-down":"move-left");br.classList.add(cw?"move-left":"move-up");return bl.classList.add(cw?"move-up":"move-right")};undo=function(callback){var col,elem,node,row,value;if(moves.length>0){elem=moves.pop();moves_sequence_dom.innerHTML=moves.length?moves.join(" "):"no moves";value=elem.slice(0,-1);node=active_nodes_dom.filter(function(n){return n.getAttribute("data-value")===`${value}`})[0];if(node){row=parseInt(node.getAttribute("data-row"));col=parseInt(node.getAttribute("data-col"));return animate(value,row,col,elem.slice(-1)!==cw_symbol,true,false,callback?callback:undo)}}};make_move=function(){return setTimeout(function(){var col,cw,elem,node,row,value;if(pre_moves.length>0){undo_button.setAttribute("disabled",true);restart_button.setAttribute("disabled",true);elem=pre_moves.shift();value=elem[0];cw=elem[1];node=active_nodes_dom.filter(function(n){return n.getAttribute("data-value")===`${value}`&&n.getAttribute(cw?"data-cw":"data-ccw")==="true"})[0];if(node){row=parseInt(node.getAttribute("data-row"));col=parseInt(node.getAttribute("data-col"));return animate(value,row,col,cw,false,true,make_move)}else{in_demo=false;undo_button.removeAttribute("disabled");return restart_button.removeAttribute("disabled")}}else{in_demo=false;undo_button.removeAttribute("disabled");return restart_button.removeAttribute("disabled")}},700)};if(pre_moves.length>0){in_demo=true;make_move()}active_nodes_dom.forEach(function(node){var col,row,value;value=parseInt(node.getAttribute("data-value"));row=parseInt(node.getAttribute("data-row"));col=parseInt(node.getAttribute("data-col"));node.addEventListener("click",function(){if(!animated){return animate(value,row,col,true)}});node.addEventListener("pointerdown",function(){if(!in_animation){animated=false;return hold_timer=setTimeout(function(){clearTimeout(hold_timer);hold_timer=null;if(!animated){return animate(value,row,col,false)}},hold_duration)}});return node.addEventListener("pointerup pointerleave pointercancel",function(){if(hold_timer){clearTimeout(hold_timer);return hold_timer=null}})});document.addEventListener("contextmenu",function(evt){var col,node,row,value;node=evt.target;if(board.contains(node)){evt.preventDefault();if(!animated&&active_nodes_dom.includes(node)){value=parseInt(node.getAttribute("data-value"));row=parseInt(node.getAttribute("data-row"));col=parseInt(node.getAttribute("data-col"));return animate(value,row,col,false)}}});undo_button.addEventListener("click",function(){undo_button.setAttribute("disabled",true);restart_button.setAttribute("disabled",true);return undo(function(){if(moves.length>0){undo_button.removeAttribute("disabled");return restart_button.removeAttribute("disabled")}})});restart_button.addEventListener("click",function(){[...document.getElementById("non-solve-text").parentElement.children].forEach(function(node){return hide_element(node)});active_nodes_dom.forEach(function(node){return show_element(node)});undo_button.setAttribute("disabled",true);show_element(undo_button);restart_button.setAttribute("disabled",true);game_completed=false;return undo()});get_cell=function(target){if(!table.contains(target)){return null}if(target.tagName!=="TD"){target=target.closest("td")}return target};validate=function(){var current,current_col,current_row,i,l,n,next,next_col,next_row,ref;n=slided_cells.length;if(n<2){return true}for(i=l=0,ref=n-1;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l){current=slided_cells[i];next=slided_cells[i+1];current_row=parseInt(current.getAttribute("data-row"));current_col=parseInt(current.getAttribute("data-col"));next_row=parseInt(next.getAttribute("data-row"));next_col=parseInt(next.getAttribute("data-col"));if(Math.abs(current_row-next_row)+Math.abs(current_col-next_col)!==1){return false}}return true};get_node_and_direction=function(){var cell,col,current_nodes,direction,elem,i,idx,j,l,len,len1,m,nn,o,possible_nodes,prev_cell,prev_col,prev_row,ref,ref1,ref2,ref3,row,v;possible_nodes=function(){var results=[];for(var l=1,ref=(N-1)*(M-1);1<=ref?l<=ref:l>=ref;1<=ref?l++:l--){results.push(l)}return results}.apply(this);direction=[];for(idx=l=0,ref1=slided_cells.length;0<=ref1?l<ref1:l>ref1;idx=0<=ref1?++l:--l){cell=slided_cells[idx];row=parseInt(cell.getAttribute("data-row"));col=parseInt(cell.getAttribute("data-col"));if(idx>0){prev_cell=slided_cells[idx-1];prev_row=parseInt(prev_cell.getAttribute("data-row"));prev_col=parseInt(prev_cell.getAttribute("data-col"));if(prev_row-row===1){direction.push("up")}else if(prev_row-row===-1){direction.push("down")}else if(prev_col-col===1){direction.push("left")}else if(prev_col-col===-1){direction.push("right")}}current_nodes=[];ref2=[0,-1];for(m=0,len=ref2.length;m<len;m++){i=ref2[m];ref3=[0,-1];for(o=0,len1=ref3.length;o<len1;o++){j=ref3[o];elem=active_nodes_dom.filter(function(n){return n.getAttribute("data-row")===`${row+i}`&&n.getAttribute("data-col")===`${col+j}`})[0];if(elem){current_nodes.push(parseInt(elem.getAttribute("data-value")))}}}possible_nodes=possible_nodes.filter(function(v){return current_nodes.indexOf(v)>=0})}nn=possible_nodes.length;if(nn===0){return false}if(possible_nodes.length===1){v=possible_nodes[0];if(direction.length>1){if(direction[0]==="up"){return[v,direction[1]==="right"]}if(direction[0]==="down"){return[v,direction[1]==="left"]}if(direction[0]==="left"){return[v,direction[1]==="up"]}if(direction[0]==="right"){return[v,direction[1]==="down"]}}else{return null}}else{return null}};table.addEventListener("pointerdown",function(e){if(!game_completed&&!in_demo){is_sliding=true;return slided_cells=[get_cell(e.target)]}});table.addEventListener("pointermove",function(e){var cell,col,cw,node,node_and_direction,row,value;if(is_sliding){cell=get_cell(document.elementFromPoint(e.clientX,e.clientY));if(cell){if(slided_cells.indexOf(cell)>=0){slided_cells=slided_cells.filter(function(c){return c!==cell});return slided_cells.push(cell)}else{slided_cells.push(cell);slided_cells=slided_cells.slice(-3);if(validate()){node_and_direction=get_node_and_direction();if(node_and_direction!==null){if(node_and_direction){value=node_and_direction[0];cw=node_and_direction[1];node=active_nodes_dom.filter(function(n){return n.getAttribute("data-value")===`${value}`&&n.getAttribute(cw?"data-cw":"data-ccw")==="true"})[0];if(node){row=parseInt(node.getAttribute("data-row"));col=parseInt(node.getAttribute("data-col"));animate(value,row,col,cw)}}is_sliding=false;return slided_cells=[]}}else{is_sliding=false;return slided_cells=[]}}}}});table.addEventListener("pointerup pointerleave pointercancel",function(){is_sliding=false;return slided_cells=[]});document.addEventListener("keydown",function(e){if(e.metaKey||e.ctrlKey){if(e.key==="x"||e.key==="X"){if(!restart_button.getAttribute("disabled")){restart_button.click()}}if(e.key==="z"||e.key==="Z"){if(!undo_button.getAttribute("disabled")){return undo_button.click()}}}});document.getElementById("copy-result").addEventListener("click",function(){var share_text;share_text=shareable_text_dom.value;navigator.clipboard.writeText(share_text).then(function(){var toast;toast=document.getElementById("copy-toast");show_element(toast);return setTimeout(function(){return hide_element(toast)},2e3)});return get_request(track_url,{game_index:game_index,init_time:(start_time-visit_time)/1e3,game_time:(end_time-start_time)/1e3,moves:moves.join(""),length:moves.length,copied:true})})}).call(this);