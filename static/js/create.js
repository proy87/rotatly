// Generated by CoffeeScript 2.7.0
(function() {
  var M, N, active_item_clone, board_palette_dom, color_palette_dom, create_clone, game_dom, get_tetramino_data, get_tetramino_indices, i, item, item_click_handler, k, len, outline_table, ref, remove_data, selected, set_data, snap_targets, tetramino_click_handler, tetramino_color_click_handler;

  selected = {
    color_icon: null,
    board_item: null
  };

  game_dom = document.querySelector('#game-container');

  color_palette_dom = document.getElementById("color-palette");

  board_palette_dom = document.getElementById("board-palette");

  item_click_handler = function(property) {
    if (selected[property]) {
      selected[property].classList.remove('selected');
      if (selected[property] === this) {
        selected[property] = null;
        return;
      }
    }
    this.classList.add('selected');
    return selected[property] = this;
  };

  remove_data = function(el, palette) {
    var color_class, span;
    color_class = el.getAttribute('data-class');
    if (color_class) {
      el.classList.remove(color_class);
      palette.querySelector(`.${color_class}`).style.display = 'flex';
    }
    el.removeAttribute('data-class');
    el.removeAttribute('data-index');
    el.removeAttribute('data-name');
    span = el.querySelector('span');
    if (span) {
      return span.innerHTML = '';
    }
  };

  set_data = function(el, klass, index, name) {
    var cell_color_class;
    cell_color_class = el.getAttribute('data-class');
    if (cell_color_class) {
      el.classList.remove(cell_color_class);
    }
    el.classList.add(klass);
    el.setAttribute('data-class', klass);
    el.setAttribute('data-index', index);
    el.setAttribute('data-name', name);
    if (name) {
      return el.querySelector('span').innerHTML = name;
    }
  };

  ref = color_palette_dom.getElementsByClassName('color-icon');
  for (k = 0, len = ref.length; k < len; k++) {
    item = ref[k];
    item.addEventListener('click', function() {
      return item_click_handler.call(this, 'color_icon');
    });
  }

  game_dom.querySelectorAll('td').forEach(function(cell) {
    return cell.addEventListener("click", function() {
      var cell_color_class, index, klass, name, selected_value;
      selected_value = selected['board_item'];
      if (selected_value) {
        cell_color_class = cell.getAttribute('data-class');
        if (cell_color_class) {
          board_palette_dom.querySelector(`.${cell_color_class}`).style.display = 'flex';
        }
        klass = selected_value.getAttribute('data-class');
        index = selected_value.getAttribute('data-index');
        name = selected_value.getAttribute('data-name');
        set_data(cell, klass, index, name);
        selected_value.classList.remove('selected');
        if (game_dom.querySelectorAll(`.${klass}`).length >= 4) {
          selected_value.style.display = 'none';
        }
        return selected['board_item'] = null;
      } else {
        cell_color_class = cell.getAttribute('data-class');
        if (cell_color_class) {
          return remove_data(cell, board_palette_dom);
        }
      }
    });
  });

  document.querySelectorAll('.node').forEach(function(node) {
    return node.addEventListener('click', function() {
      return node.classList.toggle('disabled');
    });
  });

  create_clone = function(source, click_listener = null) {
    var clone;
    clone = source.cloneNode(true);
    clone.style.position = 'absolute';
    clone.style.left = source.offsetLeft + 'px';
    clone.style.top = source.offsetTop + 'px';
    if (click_listener) {
      clone.addEventListener('click', click_listener);
    }
    source.after(clone);
    return clone;
  };

  active_item_clone = null;

  interact('.board-item').draggable({
    onstart: function(evt) {
      return active_item_clone = create_clone(evt.target);
    },
    onmove: function(evt) {
      var el, x, y;
      el = evt.target;
      x = (parseFloat(el.dataset.x) || 0) + evt.dx;
      y = (parseFloat(el.dataset.y) || 0) + evt.dy;
      el.style.transform = `translate(${x}px, ${y}px)`;
      el.dataset.x = x;
      return el.dataset.y = y;
    },
    onend: function(evt) {
      var el;
      el = evt.target;
      el.style.transform = '';
      el.removeAttribute('data-x');
      el.removeAttribute('data-y');
      active_item_clone.remove();
      return active_item_clone = null;
    }
  }).styleCursor(false);

  interact('#game-container td').dropzone({
    accept: '.board-item',
    overlap: 0.75,
    ondrop: function(evt) {
      var cell_class, el, index, klass, name, selected_value;
      el = evt.target;
      cell_class = el.getAttribute('data-class');
      if (cell_class) {
        board_palette_dom.querySelector(`.${cell_class}`).style.display = 'flex';
      }
      selected_value = evt.relatedTarget;
      klass = selected_value.getAttribute('data-class');
      index = selected_value.getAttribute('data-index');
      name = selected_value.getAttribute('data-name');
      set_data(el, klass, index, name);
      if (game_dom.querySelectorAll(`.${klass}`).length >= 4) {
        return selected_value.style.display = 'none';
      }
    }
  });

  tetramino_click_handler = function() {
    var angle;
    if (this.dataset.isDragging === 'true') {
      return this.dataset.isDragging = false;
    } else {
      angle = parseInt(this.dataset.rotationAngle);
      if (angle >= 270) {
        this.classList.remove('animate');
        angle -= 360;
        this.style.setProperty('--rotation', `${angle}deg`);
        this.offsetHeight;
        this.classList.add('animate');
      }
      this.dataset.rotationAngle = angle + 90;
      return this.style.setProperty('--rotation', `${this.dataset.rotationAngle}deg`);
    }
  };

  tetramino_color_click_handler = function() {
    var color_class, icon, index, klass, name;
    if (this.dataset.isDragging === 'true') {
      return this.dataset.isDragging = false;
    } else {
      color_class = this.querySelector('.cell').getAttribute('data-class');
      if (color_class) {
        this.querySelectorAll('.cell').forEach(function(c) {
          return remove_data(c, color_palette_dom);
        });
        color_palette_dom.querySelector(`[data-class='${color_class}']`).style.display = 'inline-block';
      }
      icon = selected['color_icon'];
      if (icon) {
        klass = icon.getAttribute('data-class');
        index = icon.getAttribute('data-index');
        name = icon.getAttribute('data-name');
        this.querySelectorAll('.cell').forEach(function(c) {
          return set_data(c, klass, index, name);
        });
        icon.classList.remove('selected');
        icon.style.display = 'none';
        return selected['color_icon'] = null;
      }
    }
  };

  document.querySelectorAll('.tetramino').forEach(function(t) {
    if (!t.parentNode.classList.contains('tet-O')) {
      t.dataset.rotationAngle = 0;
      return t.addEventListener('click', tetramino_click_handler);
    }
  });

  outline_table = document.querySelector('#outline table');

  N = outline_table.rows.length;

  M = outline_table.rows[0].cells.length;

  get_tetramino_data = function(el) {
    var cell_size, col_array, range, ref1, ref10, ref11, ref12, ref13, ref14, ref15, ref16, ref17, ref18, ref19, ref2, ref20, ref21, ref22, ref23, ref24, ref25, ref26, ref27, ref28, ref29, ref3, ref30, ref31, ref32, ref33, ref34, ref35, ref36, ref37, ref38, ref39, ref4, ref40, ref41, ref42, ref5, ref6, ref7, ref8, ref9, rotation_angle, row_array;
    cell_size = el.querySelector('.cell').getBoundingClientRect().width;
    range = cell_size / 2;
    rotation_angle = (parseInt(el.dataset.rotationAngle) || 0) % 360;
    [row_array, col_array] = [null, null];
    if (el.parentNode.classList.contains('tet-O')) {
      [row_array, col_array] = [
        (function() {
          var results = [];
          for (var l = 0, ref1 = N - 1; 0 <= ref1 ? l < ref1 : l > ref1; 0 <= ref1 ? l++ : l--){ results.push(l); }
          return results;
        }).apply(this),
        (function() {
          var results = [];
          for (var l = 0, ref2 = M - 1; 0 <= ref2 ? l < ref2 : l > ref2; 0 <= ref2 ? l++ : l--){ results.push(l); }
          return results;
        }).apply(this)
      ];
    } else if (el.parentNode.classList.contains('tet-I')) {
      if (rotation_angle === 0) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0; 0 <= N ? l < N : l > N; 0 <= N ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          [0]
        ];
      } else if (rotation_angle === 90) {
        [row_array, col_array] = [
          [0],
          (function() {
            var results = [];
            for (var l = 0; 0 <= M ? l < M : l > M; 0 <= M ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 180) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0; 0 <= N ? l < N : l > N; 0 <= N ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          [0]
        ];
      } else if (rotation_angle === 270) {
        [row_array, col_array] = [
          [0],
          (function() {
            var results = [];
            for (var l = 0; 0 <= M ? l < M : l > M; 0 <= M ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      }
    } else if (el.parentNode.classList.contains('tet-T')) {
      if (rotation_angle === 0) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref3 = N - 1; 0 <= ref3 ? l < ref3 : l > ref3; 0 <= ref3 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref4 = M - 2; 0 <= ref4 ? l < ref4 : l > ref4; 0 <= ref4 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 90) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref5 = N - 2; 0 <= ref5 ? l < ref5 : l > ref5; 0 <= ref5 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref6 = M - 1; 0 <= ref6 ? l < ref6 : l > ref6; 0 <= ref6 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 180) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref7 = N - 1; 0 <= ref7 ? l < ref7 : l > ref7; 0 <= ref7 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref8 = M - 2; 0 <= ref8 ? l < ref8 : l > ref8; 0 <= ref8 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 270) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref9 = N - 2; 0 <= ref9 ? l < ref9 : l > ref9; 0 <= ref9 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref10 = M - 1; 0 <= ref10 ? l < ref10 : l > ref10; 0 <= ref10 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      }
    } else if (el.parentNode.classList.contains('tet-L')) {
      if (rotation_angle === 0) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref11 = N - 1; 0 <= ref11 ? l < ref11 : l > ref11; 0 <= ref11 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref12 = M - 2; 0 <= ref12 ? l < ref12 : l > ref12; 0 <= ref12 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 90) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref13 = N - 2; 0 <= ref13 ? l < ref13 : l > ref13; 0 <= ref13 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref14 = M - 1; 0 <= ref14 ? l < ref14 : l > ref14; 0 <= ref14 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 180) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref15 = N - 1; 0 <= ref15 ? l < ref15 : l > ref15; 0 <= ref15 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref16 = M - 2; 0 <= ref16 ? l < ref16 : l > ref16; 0 <= ref16 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 270) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref17 = N - 2; 0 <= ref17 ? l < ref17 : l > ref17; 0 <= ref17 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref18 = M - 1; 0 <= ref18 ? l < ref18 : l > ref18; 0 <= ref18 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      }
    } else if (el.parentNode.classList.contains('tet-J')) {
      if (rotation_angle === 0) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref19 = N - 1; 0 <= ref19 ? l < ref19 : l > ref19; 0 <= ref19 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref20 = M - 2; 0 <= ref20 ? l < ref20 : l > ref20; 0 <= ref20 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 90) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref21 = N - 2; 0 <= ref21 ? l < ref21 : l > ref21; 0 <= ref21 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref22 = M - 1; 0 <= ref22 ? l < ref22 : l > ref22; 0 <= ref22 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 180) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref23 = N - 1; 0 <= ref23 ? l < ref23 : l > ref23; 0 <= ref23 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref24 = M - 2; 0 <= ref24 ? l < ref24 : l > ref24; 0 <= ref24 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 270) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref25 = N - 2; 0 <= ref25 ? l < ref25 : l > ref25; 0 <= ref25 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref26 = M - 1; 0 <= ref26 ? l < ref26 : l > ref26; 0 <= ref26 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      }
    } else if (el.parentNode.classList.contains('tet-S')) {
      if (rotation_angle === 0) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref27 = N - 1; 0 <= ref27 ? l < ref27 : l > ref27; 0 <= ref27 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref28 = M - 2; 0 <= ref28 ? l < ref28 : l > ref28; 0 <= ref28 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 90) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref29 = N - 2; 0 <= ref29 ? l < ref29 : l > ref29; 0 <= ref29 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref30 = M - 1; 0 <= ref30 ? l < ref30 : l > ref30; 0 <= ref30 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 180) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref31 = N - 1; 0 <= ref31 ? l < ref31 : l > ref31; 0 <= ref31 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref32 = M - 2; 0 <= ref32 ? l < ref32 : l > ref32; 0 <= ref32 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 270) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref33 = N - 2; 0 <= ref33 ? l < ref33 : l > ref33; 0 <= ref33 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref34 = M - 1; 0 <= ref34 ? l < ref34 : l > ref34; 0 <= ref34 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      }
    } else if (el.parentNode.classList.contains('tet-Z')) {
      if (rotation_angle === 0) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref35 = N - 1; 0 <= ref35 ? l < ref35 : l > ref35; 0 <= ref35 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref36 = M - 2; 0 <= ref36 ? l < ref36 : l > ref36; 0 <= ref36 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 90) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref37 = N - 2; 0 <= ref37 ? l < ref37 : l > ref37; 0 <= ref37 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref38 = M - 1; 0 <= ref38 ? l < ref38 : l > ref38; 0 <= ref38 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 180) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref39 = N - 1; 0 <= ref39 ? l < ref39 : l > ref39; 0 <= ref39 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref40 = M - 2; 0 <= ref40 ? l < ref40 : l > ref40; 0 <= ref40 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      } else if (rotation_angle === 270) {
        [row_array, col_array] = [
          (function() {
            var results = [];
            for (var l = 0, ref41 = N - 2; 0 <= ref41 ? l < ref41 : l > ref41; 0 <= ref41 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this),
          (function() {
            var results = [];
            for (var l = 0, ref42 = M - 1; 0 <= ref42 ? l < ref42 : l > ref42; 0 <= ref42 ? l++ : l--){ results.push(l); }
            return results;
          }).apply(this)
        ];
      }
    }
    return {
      row_array: row_array,
      col_array: col_array,
      cell_size: cell_size,
      range: range
    };
  };

  get_tetramino_indices = function(el, row, col) {
    var cells, rotation_angle;
    rotation_angle = (parseInt(el.dataset.rotationAngle) || 0) % 360;
    cells = [];
    if (el.parentNode.classList.contains('tet-O')) {
      cells = [[row, col], [row, col + 1], [row + 1, col], [row + 1, col + 1]];
    } else if (el.parentNode.classList.contains('tet-I')) {
      if (rotation_angle === 0) {
        cells = [[row, col], [row, col + 1], [row, col + 2], [row, col + 3]];
      } else if (rotation_angle === 90) {
        cells = [[row, col], [row + 1, col], [row + 2, col], [row + 3, col]];
      } else if (rotation_angle === 180) {
        cells = [[row, col], [row, col + 1], [row, col + 2], [row, col + 3]];
      } else if (rotation_angle === 270) {
        cells = [[row, col], [row + 1, col], [row + 2, col], [row + 3, col]];
      }
    } else if (el.parentNode.classList.contains('tet-T')) {
      if (rotation_angle === 0) {
        cells = [[row, col], [row, col + 1], [row, col + 2], [row + 1, col + 1]];
      } else if (rotation_angle === 90) {
        cells = [[row, col + 1], [row + 1, col], [row + 1, col + 1], [row + 2, col + 1]];
      } else if (rotation_angle === 180) {
        cells = [[row, col + 1], [row + 1, col], [row + 1, col + 1], [row + 1, col + 2]];
      } else if (rotation_angle === 270) {
        cells = [[row, col], [row + 1, col], [row + 1, col + 1], [row + 2, col]];
      }
    } else if (el.parentNode.classList.contains('tet-L')) {
      if (rotation_angle === 0) {
        cells = [[row, col], [row, col + 1], [row, col + 2], [row + 1, col]];
      } else if (rotation_angle === 90) {
        cells = [[row, col], [row, col + 1], [row + 1, col + 1], [row + 2, col + 1]];
      } else if (rotation_angle === 180) {
        cells = [[row, col + 2], [row + 1, col], [row + 1, col + 1], [row + 1, col + 2]];
      } else if (rotation_angle === 270) {
        cells = [[row, col], [row + 1, col], [row + 2, col], [row + 2, col + 1]];
      }
    } else if (el.parentNode.classList.contains('tet-J')) {
      if (rotation_angle === 0) {
        cells = [[row, col], [row, col + 1], [row, col + 2], [row + 1, col + 2]];
      } else if (rotation_angle === 90) {
        cells = [[row + 2, col], [row, col + 1], [row + 1, col + 1], [row + 2, col + 1]];
      } else if (rotation_angle === 180) {
        cells = [[row, col], [row + 1, col], [row + 1, col + 1], [row + 1, col + 2]];
      } else if (rotation_angle === 270) {
        cells = [[row, col], [row, col + 1], [row + 1, col], [row + 2, col]];
      }
    } else if (el.parentNode.classList.contains('tet-S')) {
      if (rotation_angle === 0) {
        cells = [[row, col + 1], [row, col + 2], [row + 1, col], [row + 1, col + 1]];
      } else if (rotation_angle === 90) {
        cells = [[row, col], [row + 1, col], [row + 1, col + 1], [row + 2, col + 1]];
      } else if (rotation_angle === 180) {
        cells = [[row, col + 1], [row, col + 2], [row + 1, col], [row + 1, col + 1]];
      } else if (rotation_angle === 270) {
        cells = [[row, col], [row + 1, col], [row + 1, col + 1], [row + 2, col + 1]];
      }
    } else if (el.parentNode.classList.contains('tet-Z')) {
      if (rotation_angle === 0) {
        cells = [[row, col], [row, col + 1], [row + 1, col + 1], [row + 1, col + 2]];
      } else if (rotation_angle === 90) {
        cells = [[row, col + 1], [row + 1, col], [row + 1, col + 1], [row + 2, col]];
      } else if (rotation_angle === 180) {
        cells = [[row, col], [row, col + 1], [row + 1, col + 1], [row + 1, col + 2]];
      } else if (rotation_angle === 270) {
        cells = [[row, col + 1], [row + 1, col], [row + 1, col + 1], [row + 2, col]];
      }
    }
    return cells;
  };

  snap_targets = function(index) {
    var inner;
    inner = function(x, y, interaction) {
      var c, data, el, i, idx, j, l, len1, len2, len3, m, n, offset_x, offset_y, r, ref1, ref2, ref3, table_left, table_rect, table_top;
      table_rect = outline_table.getBoundingClientRect();
      offset_y = window.pageYOffset || document.documentElement.scrollTop;
      offset_x = window.pageXOffset || document.documentElement.scrollLeft;
      table_top = table_rect.top + offset_y;
      table_left = table_rect.left + offset_x;
      el = interaction.element;
      data = get_tetramino_data(el);
      idx = 0;
      ref1 = data.row_array;
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        i = ref1[l];
        ref2 = data.col_array;
        for (m = 0, len2 = ref2.length; m < len2; m++) {
          j = ref2[m];
          if (index === idx) {
            ref3 = get_tetramino_indices(el, i, j);
            for (n = 0, len3 = ref3.length; n < len3; n++) {
              [r, c] = ref3[n];
              if (outline_table.rows[r].cells[c].getAttribute('data-number')) {
                return {
                  x: 2e308,
                  y: 2e308,
                  range: data.range
                };
              }
            }
            return {
              x: table_left + j * data.cell_size,
              y: table_top + i * data.cell_size,
              range: data.range
            };
          }
          idx += 1;
        }
      }
    };
    return inner;
  };

  interact('.tetramino').draggable({
    onstart: function(evt) {
      var el, number;
      el = evt.target;
      if (!el.classList.contains('placed')) {
        create_clone(el, tetramino_click_handler);
      }
      el.classList.remove('animate');
      el.style.setProperty('z-index', 10000);
      el.dataset.isDragging = true;
      number = el.getAttribute('data-number');
      if (number) {
        return outline_table.querySelectorAll(`[data-number='${number}']`).forEach(function(e) {
          return e.removeAttribute('data-number');
        });
      }
    },
    onmove: function(evt) {
      var el, x, y;
      el = evt.target;
      x = (parseFloat(el.dataset.x) || 0) + evt.dx;
      y = (parseFloat(el.dataset.y) || 0) + evt.dy;
      el.style.transform = `translate(${x}px, ${y}px) rotate(var(--rotation, 0))`;
      el.dataset.x = x;
      return el.dataset.y = y;
    },
    onend: function(evt) {
      var c, col, color_class, data, el, l, len1, num, r, ref1, results, row, snap, snapped;
      el = evt.target;
      snap = evt.modifiers[0];
      snapped = snap.inRange;
      if (snapped) {
        el.classList.add('placed');
        el.style.removeProperty('z-index');
        el.removeEventListener('click', tetramino_click_handler);
        el.addEventListener('click', tetramino_color_click_handler);
        data = get_tetramino_data(el);
        row = Math.floor(snap.target.index / data.col_array.length);
        col = snap.target.index % data.col_array.length;
        num = Math.random();
        ref1 = get_tetramino_indices(el, row, col);
        results = [];
        for (l = 0, len1 = ref1.length; l < len1; l++) {
          [r, c] = ref1[l];
          outline_table.rows[r].cells[c].setAttribute('data-number', num);
          results.push(el.setAttribute('data-number', num));
        }
        return results;
      } else {
        outline_table.querySelectorAll(`[data-number='${el.getAttribute('data-number')}']`).forEach(function(e) {
          return e.removeAttribute('data-number');
        });
        color_class = el.querySelector('.cell').getAttribute('data-class');
        if (color_class) {
          el.querySelectorAll('.cell').forEach(function(c) {
            return remove_data(c, color_palette_dom);
          });
          color_palette_dom.querySelector(`[data-class='${color_class}']`).style.display = 'inline-block';
        }
        return el.remove();
      }
    },
    modifiers: [
      interact.modifiers.snap({
        targets: (function() {
          var l,
      results;
          results = [];
          for (i = l = 0; l < 9; i = ++l) {
            results.push(snap_targets(i));
          }
          return results;
        })(),
        relativePoints: [
          {
            x: 0,
            y: 0
          }
        ]
      })
    ]
  }).styleCursor(false);

  interact('#outline table').dropzone({
    accept: '.tetramino',
    overlap: 0.8
  });

}).call(this);

//# sourceMappingURL=create.js.map
