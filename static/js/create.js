// Generated by CoffeeScript 2.7.0
(function() {
  var color_icon_click_handler, color_icons_dom, copy_outline, icon, insert_color_icon, k, len, outline_cells_selector, outline_dom, outline_hidden_dom, outlines_dom, palette_dom, remove_color_class, selected_color_icon, selected_outline, set_color_class;

  selected_outline = null;

  selected_color_icon = null;

  outlines_dom = [...document.querySelectorAll('#outlines > .outline-container')];

  outline_dom = document.querySelector('#outline > .outline-container');

  outline_hidden_dom = document.querySelector('#outline-hidden > .outline-container');

  copy_outline = function(src, target) {
    var i, j, k, l, ref, ref1, src_cell, src_table, target_cell, target_table;
    target.setAttribute('data-index', src.getAttribute('data-index'));
    src_table = src.querySelector('table');
    target_table = target.querySelector('table');
    for (i = k = 0, ref = src_table.rows.length; (0 <= ref ? k < ref : k > ref); i = 0 <= ref ? ++k : --k) {
      for (j = l = 0, ref1 = src_table.rows[0].cells.length; (0 <= ref1 ? l < ref1 : l > ref1); j = 0 <= ref1 ? ++l : --l) {
        target_cell = target_table.rows[i].cells[j];
        src_cell = src_table.rows[i].cells[j];
        target_cell.setAttribute('data-value', src_cell.getAttribute('data-value'));
        remove_color_class(target_cell);
      }
    }
    return target.querySelector('.outline-grid').innerHTML = src.querySelector('.outline-grid').innerHTML;
  };

  outlines_dom.forEach(function(outline) {
    return outline.addEventListener('click', function() {
      if (selected_outline) {
        selected_outline.classList.remove('selected');
        if (selected_outline === this) {
          copy_outline(outline_hidden_dom, outline_dom);
          selected_outline = null;
          return;
        }
      }
      this.classList.add('selected');
      selected_outline = this;
      return copy_outline(selected_outline, outline_dom);
    });
  });

  color_icon_click_handler = function() {
    if (selected_color_icon) {
      selected_color_icon.classList.remove('selected');
      if (selected_color_icon === this) {
        selected_color_icon = null;
        return;
      }
    }
    this.classList.add('selected');
    return selected_color_icon = this;
  };

  palette_dom = document.getElementById("color-palette");

  color_icons_dom = palette_dom.getElementsByClassName('color-icon');

  for (k = 0, len = color_icons_dom.length; k < len; k++) {
    icon = color_icons_dom[k];
    icon.addEventListener('click', color_icon_click_handler);
  }

  insert_color_icon = function(color_class, index) {
    var color_icon, idx, inserted, l, len1;
    index = parseInt(index);
    color_icon = document.createElement('div');
    color_icon.classList.add('color-icon');
    color_icon.classList.add(color_class);
    color_icon.setAttribute('data-color-class', color_class);
    color_icon.setAttribute('data-index', index);
    color_icon.addEventListener('click', color_icon_click_handler);
    inserted = false;
    for (l = 0, len1 = color_icons_dom.length; l < len1; l++) {
      icon = color_icons_dom[l];
      idx = parseInt(icon.getAttribute('data-index'));
      if (idx >= index) {
        inserted = true;
        if (idx !== index) {
          icon.before(color_icon);
        }
        break;
      }
    }
    if (!inserted) {
      return palette_dom.appendChild(color_icon);
    }
  };

  outline_cells_selector = "#outline td";

  remove_color_class = function(cell) {
    var color_class;
    color_class = cell.getAttribute('data-color-class');
    if (color_class) {
      cell.classList.remove(color_class);
      insert_color_icon(color_class, cell.getAttribute('data-color-index'));
    }
    cell.removeAttribute('data-color-class');
    return cell.removeAttribute('data-color-index');
  };

  set_color_class = function(cell, color_class, color_index) {
    var cell_color_class;
    cell_color_class = cell.getAttribute('data-color-class');
    if (cell_color_class) {
      cell.classList.remove(cell_color_class);
    }
    cell.classList.add(color_class);
    cell.setAttribute('data-color-class', color_class);
    return cell.setAttribute('data-color-index', color_index);
  };

  document.querySelectorAll(outline_cells_selector).forEach(function(cell) {
    return cell.addEventListener("click", function() {
      var cell_color_class, color_class, color_index, value;
      value = cell.getAttribute('data-value');
      if (selected_color_icon) {
        cell_color_class = cell.getAttribute('data-color-class');
        if (cell_color_class) {
          insert_color_icon(cell_color_class, cell.getAttribute('data-color-index'));
        }
        color_class = selected_color_icon.getAttribute('data-color-class');
        color_index = selected_color_icon.getAttribute('data-index');
        document.querySelectorAll(outline_cells_selector + `[data-value='${value}']`).forEach(function(c) {
          return set_color_class(c, color_class, color_index);
        });
        selected_color_icon.remove();
        return selected_color_icon = null;
      } else {
        cell_color_class = cell.getAttribute('data-color-class');
        if (cell_color_class) {
          return document.querySelectorAll(outline_cells_selector + `[data-value='${value}']`).forEach(function(c) {
            return remove_color_class(c);
          });
        }
      }
    });
  });

}).call(this);

//# sourceMappingURL=create.js.map
