{
  "version": 3,
  "file": "game.js",
  "sourceRoot": "\\",
  "sources": [
    "game.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "visit_time = new Date()\r\nstart_time = visit_time\r\nend_time = start_time\r\n\r\nboard = document.getElementById('game-container')\r\ntable = board.querySelector('table')\r\n\r\nN = table.rows.length\r\nM = table.rows[0].cells.length\r\ngame_completed = false\r\nin_animation = false\r\nanimated = false\r\nin_demo = false\r\nmoves = []\r\n\r\nmoves_made_num_dom = document.getElementById('moves-made-num')\r\nundo_button = document.getElementById('undo-move')\r\nrestart_button = document.getElementById('restart-game')\r\nmoves_sequence_dom = document.getElementById('moves-sequence')\r\none_less_move_dom = document.getElementById('one-less-move')\r\nmoves_num_dom = document.getElementById('moves-num')\r\nactive_nodes_dom = [...document.querySelectorAll('.node.active')]\r\nshareable_text_dom = document.getElementById('shareable-text')\r\npuzzle_date_dom = document.getElementById('puzzle-date')\r\ntoday_date = null\r\nif puzzle_date_dom\r\n  min_date = puzzle_date_dom.getAttribute('min')\r\n  max_date = puzzle_date_dom.getAttribute('max')\r\n  today_date = puzzle_date_dom.value\r\n  puzzle_date_dom.addEventListener(\"change\", ->\r\n    value = this.value\r\n    if value and /^\\d{4}-\\d{2}-\\d{2}$/.test(value) and min_date <= value <= max_date\r\n      window.location.href = \"/#{value}/\"\r\n  )\r\n\r\nhold_timer = null\r\nhold_duration = 500\r\n\r\nis_sliding = false\r\nslided_cells = []\r\n\r\nis_rotate_node = (node)->\r\n  return node.getAttribute('data-name') == 'rotate'\r\n\r\nget_cells_from_indices = (indices) ->\r\n  cells = []\r\n  for index in indices\r\n    row = Math.floor(index / M)\r\n    col = index % M\r\n    cells.push(document.getElementById(\"cell-#{row}-#{col}\"))\r\n  return cells\r\n\r\nget_source_indices = (node, direct)->\r\n  arr = node.getAttribute(\"data-#{if direct then 'source' else 'target'}\").split(',')\r\n  return arr.map((item) ->\r\n    parseInt(item))\r\n\r\nget_target_indices = (node, direct)->\r\n  arr = node.getAttribute(\"data-#{if direct then 'target' else 'source'}\").split(',')\r\n  return arr.map((item) ->\r\n    parseInt(item))\r\n\r\nget_source_cells = (node, direct) ->\r\n  return get_cells_from_indices(get_source_indices(node, direct))\r\n\r\nget_target_cells = (node, direct) ->\r\n  return get_cells_from_indices(get_target_indices(node, direct))\r\n\r\nrotate = (node, direct)->\r\n  htmls = []\r\n  classes = []\r\n  values = []\r\n  for cell in get_source_cells(node, direct)\r\n    htmls.push(cell.innerHTML)\r\n    classes.push(cell.className)\r\n    values.push(cell.getAttribute('data-value'))\r\n\r\n  for cell, i in get_target_cells(node, direct)\r\n    cell.innerHTML = htmls[i]\r\n    cell.className = classes[i]\r\n    cell.setAttribute('data-value', values[i])\r\n\r\ncheck = ->\r\n  for index in [0...N * M]\r\n    row = Math.floor(index / M)\r\n    col = index % M\r\n    elem = document.getElementById(\"cell-#{row}-#{col}\")\r\n    value = parseInt(elem.getAttribute('data-value'))\r\n    if outline[index] < 0 and value != outline[index]\r\n      return false\r\n    for index1 in [index + 1 ... N * M]\r\n      row1 = Math.floor(index1 / M)\r\n      col1 = index1 % M\r\n      elem1 = document.getElementById(\"cell-#{row1}-#{col1}\")\r\n      value1 = parseInt(elem1.getAttribute('data-value'))\r\n      if !(value != value1) != !(outline[index] != outline[index1])\r\n        return false\r\n  return true\r\n\r\nset_shareable_text = ->\r\n  moves_made = moves.length\r\n  emoji = null\r\n  text = null\r\n  full_text = null\r\n  rows = null\r\n\r\n  number = \"##{game_index}\"\r\n  if today_date\r\n    number += \" (#{today_date})\"\r\n\r\n  if check()\r\n    if moves_made == moves_min_num\r\n      emoji = 'ðŸ§ âœ¨'\r\n      text = 'Perfect Solve'\r\n    else if moves_made - moves_min_num <= 3\r\n      emoji = 'ðŸ¤'\r\n      text = 'So close!'\r\n    else\r\n      emoji = 'ðŸ§©'\r\n      text = 'Solved'\r\n    full_text = \"Rotatly #{number} #{emoji}\\n#{text}\\nMoves: #{moves_made}/#{moves_min_num}\\n#{canonical_url}\"\r\n  else\r\n    moves_text = ''\r\n    if moves_made == 0\r\n      emoji = 'ðŸ˜´'\r\n      moves_text = \"Didn't try today\\nIt's never too late to start!\"\r\n    else if moves_made < moves_min_num * 2\r\n      emoji = 'â³'\r\n      moves_text = \"Rotatingâ€¦\\nMoves: #{moves_made}\"\r\n    else\r\n      emoji = 'ðŸ˜¤'\r\n      moves_text = \"This one got me\\nWant to take a shot?\"\r\n\r\n    full_text = \"Rotatly #{number} #{emoji}\\n#{moves_text}\\n#{canonical_url}\"\r\n\r\n  shareable_text_dom.value = full_text\r\n\r\nset_shareable_text()\r\n\r\nanimate = (node, direct, undo = false, demo = false, callback = null) ->\r\n  if in_animation\r\n    return\r\n  in_animation = true\r\n  animated = true\r\n  finished = 0\r\n  cells = get_target_cells(node, true)\r\n  node_name = node.getAttribute('data-name')\r\n  if is_rotate_node(node)\r\n    classes = [(if direct then 'move-right' else 'move-down'), (if direct then 'move-down' else 'move-left'),\r\n      (if direct then 'move-left' else 'move-up'), (if direct then 'move-up' else 'move-right')]\r\n  else if node_name == 'horizontal'\r\n    classes = ((if direct then 'move-right' else 'move-left') for i in [0...cells.length])\r\n  else if node_name == 'vertical'\r\n    classes = ((if direct then 'move-down' else 'move-up') for i in [0...cells.length])\r\n\r\n  transition_callback = (e)->\r\n    if e.propertyName == 'transform'\r\n      finished += 1\r\n      if finished == cells.length\r\n        for c, idx in cells\r\n          c.classList.remove('animate')\r\n          c.classList.add('non-animate')\r\n          c.removeEventListener('transitionend', transition_callback)\r\n          c.classList.remove(classes[idx])\r\n        for c in cells\r\n          c.offsetHeight\r\n        rotate(node, direct)\r\n        if not undo\r\n          symbol = node.getAttribute(\"data#{if direct then '' else '-reverse'}-symbol\")\r\n          moves.push(\"#{node.getAttribute('data-index')}#{symbol}\")\r\n          moves_sequence_dom.innerHTML = if moves.length then moves.join(' ') else 'no moves'\r\n          if not demo\r\n            undo_button.removeAttribute('disabled')\r\n            restart_button.removeAttribute('disabled')\r\n\r\n        number_of_moves = moves.length\r\n        set_shareable_text()\r\n        if number_of_moves == 1 and not undo\r\n          start_time = new Date()\r\n        moves_made_num_dom.innerHTML = number_of_moves\r\n        solved = check()\r\n        if not demo and (number_of_moves >= moves_max_num or solved)\r\n          end_time = new Date()\r\n          game_completed = true\r\n          active_nodes_dom.forEach((node)->\r\n            window.hide_element(node)\r\n          )\r\n          window.hide_element(undo_button)\r\n          if solved\r\n            one_less_move_dom.innerHTML = number_of_moves - 1\r\n            moves_num_dom.innerHTML = number_of_moves\r\n            block = document.getElementById(\"#{if number_of_moves > moves_min_num then 'non-' else ''}min-text\")\r\n          else\r\n            block = document.getElementById(\"non-solve-text\")\r\n          #window.show_element(block)\r\n\r\n          window.send_request(track_url, {\r\n            game_index: game_index, init_time: (start_time - visit_time) / 1000,\r\n            game_time: (end_time - start_time) / 1000, moves: moves.join(''), length: number_of_moves\r\n          })\r\n\r\n        in_animation = false\r\n\r\n        if callback\r\n          callback()\r\n\r\n  for cell, idx in cells\r\n    cell.classList.remove('non-animate')\r\n    cell.classList.add('animate')\r\n    cell.addEventListener('transitionend', transition_callback)\r\n    cell.classList.add(classes[idx])\r\n\r\n\r\nundo = (callback)->\r\n  if moves.length > 0\r\n    elem = moves.pop()\r\n    moves_sequence_dom.innerHTML = if moves.length then moves.join(' ') else 'no moves'\r\n    index = elem.slice(0, -1)\r\n    direction = elem.slice(-1)\r\n    node = active_nodes_dom.filter((n)->\r\n      if n.getAttribute('data-index') == \"#{index}\"\r\n        if n.getAttribute('data-symbol') == direction or n.getAttribute('data-reverse-symbol') == direction\r\n          return true\r\n    )[0]\r\n    if node\r\n      animate(node, direction != node.getAttribute('data-symbol'), true, false, if callback then callback else undo)\r\n\r\nmake_move = ->\r\n  setTimeout(->\r\n    if pre_moves.length > 0\r\n      undo_button.setAttribute('disabled', true)\r\n      restart_button.setAttribute('disabled', true)\r\n      elem = pre_moves.shift()\r\n      index = elem[0]\r\n      direction = elem[1]\r\n      node = active_nodes_dom.filter((n)->\r\n        if n.getAttribute('data-index') == \"#{index}\"\r\n          if n.getAttribute('data-symbol') == direction and n.getAttribute('data-allow-direct') == 'true'\r\n            return true\r\n          if n.getAttribute('data-reverse-symbol') == direction and n.getAttribute('data-allow-reverse') == 'true'\r\n            return true\r\n      )[0]\r\n      if node\r\n        animate(node, direction == node.getAttribute('data-symbol'), false, true, make_move)\r\n      else\r\n        in_demo = false\r\n        undo_button.removeAttribute('disabled')\r\n        restart_button.removeAttribute('disabled')\r\n    else\r\n      in_demo = false\r\n      undo_button.removeAttribute('disabled')\r\n      restart_button.removeAttribute('disabled')\r\n  , 700)\r\n\r\nif pre_moves.length > 0\r\n  in_demo = true\r\n  make_move()\r\n\r\nactive_nodes_dom.filter((n)-> is_rotate_node(n)).forEach((node)->\r\n  node.addEventListener('click', ->\r\n    if not animated\r\n      animate(this, true)\r\n  )\r\n  node.addEventListener('pointerdown', ->\r\n    n = this\r\n    if not in_animation\r\n      animated = false\r\n      hold_timer = setTimeout(->\r\n        clearTimeout(hold_timer)\r\n        hold_timer = null\r\n        if not animated\r\n          animate(n, false)\r\n      , hold_duration\r\n      )\r\n  )\r\n  node.addEventListener('pointerup pointerleave pointercancel', ->\r\n    if hold_timer\r\n      clearTimeout(hold_timer)\r\n      hold_timer = null\r\n  )\r\n)\r\n\r\nactive_nodes_dom.filter((n)-> not is_rotate_node(n)).forEach((node)->\r\n  node.addEventListener('click', ->\r\n    animate(this, node.getAttribute('data-direction') == node.getAttribute('data-symbol'))\r\n  )\r\n)\r\n\r\ndocument.addEventListener('contextmenu', (evt)->\r\n  node = evt.target\r\n  if board.contains(node)\r\n    evt.preventDefault()\r\n    if not animated and is_rotate_node(node) and active_nodes_dom.includes(node)\r\n      animate(node, false)\r\n)\r\n\r\nundo_button.addEventListener('click', ->\r\n  undo_button.setAttribute('disabled', true)\r\n  restart_button.setAttribute('disabled', true)\r\n  undo(->\r\n    if moves.length > 0\r\n      undo_button.removeAttribute('disabled')\r\n      restart_button.removeAttribute('disabled')\r\n  )\r\n)\r\nrestart_button.addEventListener('click', ->\r\n  [...document.getElementById(\"non-solve-text\").parentElement.children].forEach((node)->\r\n    window.hide_element(node)\r\n  )\r\n  active_nodes_dom.forEach((node)-> window.show_element(node))\r\n  undo_button.setAttribute('disabled', true)\r\n  window.show_element(undo_button)\r\n  restart_button.setAttribute('disabled', true)\r\n  game_completed = false\r\n  undo()\r\n)\r\n\r\nget_cell = (target)->\r\n  if not table.contains(target)\r\n    return null\r\n  if target.tagName != 'TD'\r\n    target = target.closest('td')\r\n  return target\r\n\r\nvalidate = ->\r\n  n = slided_cells.length\r\n  if n < 2\r\n    return true\r\n  for i in [0...n - 1]\r\n    current = slided_cells[i]\r\n    next = slided_cells[i + 1]\r\n    current_row = parseInt(current.getAttribute('data-row'))\r\n    current_col = parseInt(current.getAttribute('data-col'))\r\n    next_row = parseInt(next.getAttribute('data-row'))\r\n    next_col = parseInt(next.getAttribute('data-col'))\r\n    if Math.abs(current_row - next_row) + Math.abs(current_col - next_col) != 1\r\n      return false\r\n  return true\r\n\r\nget_node_and_direction = ->\r\n  if slided_cells.length != 3\r\n    return null\r\n\r\n  indices = []\r\n  for cell in slided_cells\r\n    row = parseInt(cell.getAttribute('data-row'))\r\n    col = parseInt(cell.getAttribute('data-col'))\r\n    indices.push(row * M + col)\r\n\r\n  indices_str = indices.join(',')\r\n  for node in active_nodes_dom\r\n    node_indices = get_target_indices(node, true)\r\n    node_indices = node_indices.concat(node_indices)\r\n    if node_indices.join(',').includes(indices_str)\r\n      return [node, true]\r\n\r\n    node_indices.reverse()\r\n    if node_indices.join(',').includes(indices_str)\r\n      return [node, false]\r\n\r\n\r\ntable.addEventListener(\"pointerdown\", (e)->\r\n  if not game_completed and not in_demo\r\n    is_sliding = true\r\n    slided_cells = [get_cell(e.target)]\r\n)\r\ntable.addEventListener(\"pointermove\", (e)->\r\n  if is_sliding\r\n    cell = get_cell(document.elementFromPoint(e.clientX, e.clientY))\r\n    if cell\r\n      if slided_cells.indexOf(cell) >= 0\r\n        slided_cells = slided_cells.filter((c)-> c != cell)\r\n        slided_cells.push(cell)\r\n      else\r\n        slided_cells.push(cell)\r\n        slided_cells = slided_cells.slice(-3)\r\n        if validate()\r\n          node_and_direction = get_node_and_direction()\r\n          if node_and_direction != null\r\n            if node_and_direction\r\n              node = node_and_direction[0]\r\n              direct = node_and_direction[1]\r\n              if node and node.getAttribute(\"data-allow-#{if direct then 'direct' else 'reverse'}\") == 'true'\r\n                animate(node, direct)\r\n            is_sliding = false\r\n            slided_cells = []\r\n        else\r\n          is_sliding = false\r\n          slided_cells = []\r\n)\r\ntable.addEventListener(\"pointerup pointerleave pointercancel\", ->\r\n  is_sliding = false\r\n  slided_cells = []\r\n)\r\n\r\ndocument.addEventListener('keydown', (e)->\r\n  if e.metaKey or e.ctrlKey\r\n    if e.key == 'x' or e.key == 'X'\r\n      if not restart_button.getAttribute('disabled')\r\n        restart_button.click()\r\n\r\n    if e.key == 'z' or e.key == 'Z'\r\n      if not undo_button.getAttribute('disabled')\r\n        undo_button.click()\r\n)\r\n\r\ndocument.getElementById('copy-result').addEventListener('click', ->\r\n  share_text = shareable_text_dom.value\r\n  navigator.clipboard.writeText(share_text).then(->\r\n    toast = document.getElementById('copy-toast')\r\n    window.show_element(toast)\r\n    setTimeout(->\r\n      window.hide_element(toast)\r\n    , 2000)\r\n  )\r\n  window.send_request(track_url, {\r\n      game_index: game_index,\r\n      init_time: (start_time - visit_time) / 1000,\r\n      game_time: (end_time - start_time) / 1000,\r\n      moves: moves.join(''),\r\n      length: moves.length,\r\n      copied: true,\r\n    }\r\n  )\r\n)\r\n\r\ndocument.getElementById('share-icon').addEventListener('click', ->\r\n  container = document.getElementById('share-container')\r\n  container.parentNode.insertBefore(container, document.getElementById('target-outline-container'))\r\n  container.insertBefore(shareable_text_dom, document.getElementById('copy-result'))\r\n)"
  ]
}