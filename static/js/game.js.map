{
  "version": 3,
  "file": "game.js",
  "sourceRoot": "\\",
  "sources": [
    "game.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "visit_time = new Date()\r\nstart_time = visit_time\r\nend_time = start_time\r\n\r\nboard = document.getElementById('board')\r\ntable = board.querySelector('table')\r\n\r\nN = table.rows.length\r\nM = table.rows[0].cells.length\r\ngame_completed = false\r\nin_animation = false\r\nanimated = false\r\nin_demo = false\r\nmoves = []\r\n\r\nmoves_made_num_dom = document.getElementById('moves-made-num')\r\nundo_button = document.getElementById('undo-move')\r\nrestart_button = document.getElementById('restart-game')\r\nmoves_sequence_dom = document.getElementById('moves-sequence')\r\none_less_move_dom = document.getElementById('one-less-move')\r\nmoves_num_dom = document.getElementById('moves-num')\r\nactive_nodes_dom = [...document.querySelectorAll('.node.active')]\r\n\r\n\r\nhold_timer = null\r\nhold_duration = 500\r\n\r\nis_sliding = false\r\nslided_cells = []\r\n\r\nhide_element = (el)->\r\n  display = window.getComputedStyle(el, null).display\r\n  if display != 'none'\r\n    el.setAttribute('data-display', display)\r\n  el.style.display = 'none'\r\n\r\nshow_element = (el)->\r\n  display = window.getComputedStyle(el, null).display\r\n  if display == 'none'\r\n    el.style.display = el.getAttribute('data-display') or 'block'\r\n\r\nget_request = (url, data)->\r\n  params = []\r\n  for k, v of data\r\n    params.push(\"#{k}=#{v}\")\r\n  await fetch(url + '?' + params.join('&'))\r\n\r\na2a_config.callbacks = [\r\n  share: (share_data)->\r\n    title = null\r\n    url = null\r\n    if moves.length\r\n      if check()\r\n        title = \"Rotatly ##{game_index} in #{moves.length} moves\"\r\n      else\r\n        title = \"Rotatly ##{game_index}\"\r\n      rcw = new RegExp(cw_symbol, 'g')\r\n      rccw = new RegExp(ccw_symbol, 'g')\r\n      url = canonical_url + \"?moves=#{moves.join('').replace(rcw, '%E2%86%BB').replace(rccw, '%E2%86%BA')}\"\r\n    else\r\n      title = \"Rotatly\"\r\n      url = today_url\r\n\r\n    get_request(track_url, {\r\n      game_index: game_index,\r\n      init_time: (start_time - visit_time) / 1000,\r\n      game_time: (end_time - start_time) / 1000,\r\n      moves: moves.join(''),\r\n      length: moves.length,\r\n      share: share_data.service\r\n    })\r\n\r\n    return {\r\n      title: title,\r\n      description: 'Rotate the cells until you get the correct outline.',\r\n      url: url\r\n    }\r\n]\r\nrotate = (row, col, cw)->\r\n  top_left = document.getElementById(\"cell-#{row}-#{col}\")\r\n  top_right = document.getElementById(\"cell-#{row}-#{col + 1}\")\r\n  bottom_left = document.getElementById(\"cell-#{row + 1}-#{col}\")\r\n  bottom_right = document.getElementById(\"cell-#{row + 1}-#{col + 1}\")\r\n  a = top_left.innerHTML\r\n  b = top_right.innerHTML\r\n  c = bottom_left.innerHTML\r\n  d = bottom_right.innerHTML\r\n  top_left.innerHTML = if cw then c else b\r\n  top_right.innerHTML = if cw then a else d\r\n  bottom_left.innerHTML = if cw then d else a\r\n  bottom_right.innerHTML = if cw then b else c\r\n\r\n  a = top_left.className\r\n  b = top_right.className\r\n  c = bottom_left.className\r\n  d = bottom_right.className\r\n  top_left.className = if cw then c else b\r\n  top_right.className = if cw then a else d\r\n  bottom_left.className = if cw then d else a\r\n  bottom_right.className = if cw then b else c\r\n\r\n  a = top_left.getAttribute('data-value')\r\n  b = top_right.getAttribute('data-value')\r\n  c = bottom_left.getAttribute('data-value')\r\n  d = bottom_right.getAttribute('data-value')\r\n  top_left.setAttribute('data-value', if cw then c else b)\r\n  top_right.setAttribute('data-value', if cw then a else d)\r\n  bottom_left.setAttribute('data-value', if cw then d else a)\r\n  bottom_right.setAttribute('data-value', if cw then b else c)\r\n\r\ncheck = ->\r\n  for index in [0...N * M]\r\n    row = Math.floor(index / M)\r\n    col = index % M\r\n    elem = document.getElementById(\"cell-#{row}-#{col}\")\r\n    value = parseInt(elem.getAttribute('data-value'))\r\n    if outline[index] < 0 and value != outline[index]\r\n      return false\r\n    for index1 in [index + 1 ... N * M]\r\n      row1 = Math.floor(index1 / M)\r\n      col1 = index1 % M\r\n      elem1 = document.getElementById(\"cell-#{row1}-#{col1}\")\r\n      value1 = parseInt(elem1.getAttribute('data-value'))\r\n      if !(value != value1) != !(outline[index] != outline[index1])\r\n        return false\r\n  return true\r\n\r\nanimate = (value, row, col, cw, undo = false, demo = false, callback = null) ->\r\n  if in_animation\r\n    return\r\n  in_animation = true\r\n  animated = true\r\n  tl = document.getElementById(\"cell-#{row}-#{col}\")\r\n  tr = document.getElementById(\"cell-#{row}-#{col + 1}\")\r\n  br = document.getElementById(\"cell-#{row + 1}-#{col + 1}\")\r\n  bl = document.getElementById(\"cell-#{row + 1}-#{col}\")\r\n\r\n  finished = 0\r\n  cells = [tl, tr, br, bl]\r\n  transition_callback = (e)->\r\n    if e.propertyName == 'transform'\r\n      finished += 1\r\n      if finished == cells.length\r\n        for c in cells\r\n          c.classList.remove('animate')\r\n          c.classList.add('non-animate')\r\n          c.removeEventListener('transitionend', transition_callback)\r\n        tl.classList.remove(if cw then 'move-right' else 'move-down')\r\n        tr.classList.remove(if cw then 'move-down' else 'move-left')\r\n        br.classList.remove(if cw then 'move-left' else 'move-up')\r\n        bl.classList.remove(if cw then 'move-up' else 'move-right')\r\n        for c in cells\r\n          c.offsetHeight\r\n        rotate(row, col, cw)\r\n        if not undo\r\n          moves.push(\"#{value}#{if cw then cw_symbol else ccw_symbol}\")\r\n          moves_sequence_dom.innerHTML = if moves.length then moves.join(' ') else 'no moves'\r\n          if not demo\r\n            undo_button.removeAttribute('disabled')\r\n            restart_button.removeAttribute('disabled')\r\n\r\n        number_of_moves = moves.length\r\n        if number_of_moves == 1 and not undo\r\n          start_time = new Date()\r\n        moves_made_num_dom.innerHTML = number_of_moves\r\n        solved = check()\r\n        if not demo and (number_of_moves >= moves_max_num or solved)\r\n          end_time = new Date()\r\n          game_completed = true\r\n          active_nodes_dom.forEach((node)->\r\n            hide_element(node)\r\n          )\r\n          hide_element(undo_button)\r\n          if solved\r\n            one_less_move_dom.innerHTML = number_of_moves - 1\r\n            moves_num_dom.innerHTML = number_of_moves\r\n            block = document.getElementById(\"#{if number_of_moves > moves_min_num then 'non-' else ''}min-text\")\r\n          else\r\n            block = document.getElementById(\"non-solve-text\")\r\n          show_element(block)\r\n\r\n          document.getElementById(\"share-container\").style.display = 'flex'\r\n\r\n          get_request(track_url, {\r\n            game_index: game_index, init_time: (start_time - visit_time) / 1000,\r\n            game_time: (end_time - start_time) / 1000, moves: moves.join(''), length: number_of_moves\r\n          })\r\n\r\n        in_animation = false\r\n\r\n        if callback\r\n          callback()\r\n\r\n  for cell in cells\r\n    cell.classList.remove('non-animate')\r\n    cell.classList.add('animate')\r\n    cell.addEventListener('transitionend', transition_callback)\r\n\r\n  tl.classList.add(if cw then 'move-right' else 'move-down')\r\n  tr.classList.add(if cw then 'move-down' else 'move-left')\r\n  br.classList.add(if cw then 'move-left' else 'move-up')\r\n  bl.classList.add(if cw then 'move-up' else 'move-right')\r\n\r\nundo = (callback)->\r\n  if moves.length > 0\r\n    elem = moves.pop()\r\n    moves_sequence_dom.innerHTML = if moves.length then moves.join(' ') else 'no moves'\r\n    value = elem.slice(0, -1)\r\n    node = active_nodes_dom.filter((n)-> n.getAttribute('data-value') == \"#{value}\")[0]\r\n    if node\r\n      row = parseInt(node.getAttribute('data-row'))\r\n      col = parseInt(node.getAttribute('data-col'))\r\n      animate(value, row, col, elem.slice(-1) != cw_symbol, true, false, if callback then callback else undo)\r\n\r\nmake_move = ->\r\n  setTimeout(->\r\n    if pre_moves.length > 0\r\n      undo_button.setAttribute('disabled', true)\r\n      restart_button.setAttribute('disabled', true)\r\n      elem = pre_moves.shift()\r\n      value = elem[0]\r\n      cw = elem[1]\r\n      node = active_nodes_dom.filter((n)-> n.getAttribute('data-value') == \"#{value}\" and n.getAttribute(if cw then 'data-cw' else 'data-ccw') == \"true\")[0]\r\n      if node\r\n        row = parseInt(node.getAttribute('data-row'))\r\n        col = parseInt(node.getAttribute('data-col'))\r\n        animate(value, row, col, cw, false, true, make_move)\r\n      else\r\n        in_demo = false\r\n        undo_button.removeAttribute('disabled')\r\n        restart_button.removeAttribute('disabled')\r\n    else\r\n      in_demo = false\r\n      undo_button.removeAttribute('disabled')\r\n      restart_button.removeAttribute('disabled')\r\n  , 700)\r\n\r\nif pre_moves.length > 0\r\n  in_demo = true\r\n  make_move()\r\n\r\nactive_nodes_dom.forEach((node)->\r\n  value = parseInt(node.getAttribute('data-value'))\r\n  row = parseInt(node.getAttribute('data-row'))\r\n  col = parseInt(node.getAttribute('data-col'))\r\n  node.addEventListener('click', ->\r\n    if not animated\r\n      animate(value, row, col, true)\r\n  )\r\n  node.addEventListener('pointerdown', ->\r\n    if not in_animation\r\n      animated = false\r\n      hold_timer = setTimeout(->\r\n        clearTimeout(hold_timer)\r\n        hold_timer = null\r\n        if not animated\r\n          animate(value, row, col, false)\r\n      , hold_duration\r\n      )\r\n  )\r\n  node.addEventListener('pointerup pointerleave pointercancel', ->\r\n    if hold_timer\r\n      clearTimeout(hold_timer)\r\n      hold_timer = null\r\n  )\r\n)\r\n\r\ndocument.addEventListener('contextmenu', (evt)->\r\n  node = evt.target\r\n  if board.contains(node)\r\n    evt.preventDefault()\r\n    if not animated and active_nodes_dom.includes(node)\r\n      value = parseInt(node.getAttribute('data-value'))\r\n      row = parseInt(node.getAttribute('data-row'))\r\n      col = parseInt(node.getAttribute('data-col'))\r\n      animate(value, row, col, false)\r\n)\r\n\r\nundo_button.addEventListener('click', ->\r\n  undo_button.setAttribute('disabled', true)\r\n  restart_button.setAttribute('disabled', true)\r\n  undo(->\r\n    if moves.length > 0\r\n      undo_button.removeAttribute('disabled')\r\n      restart_button.removeAttribute('disabled')\r\n  )\r\n)\r\nrestart_button.addEventListener('click', ->\r\n  [...document.getElementById(\"non-solve-text\").parentElement.children].forEach((node)->\r\n    hide_element(node)\r\n  )\r\n  active_nodes_dom.forEach((node)-> show_element(node))\r\n  undo_button.setAttribute('disabled', true)\r\n  show_element(undo_button)\r\n  restart_button.setAttribute('disabled', true)\r\n  game_completed = false\r\n  undo()\r\n)\r\n\r\nget_cell = (target)->\r\n  if not table.contains(target)\r\n    return null\r\n  if target.tagName != 'TD'\r\n    target = target.closest('td')\r\n  return target\r\n\r\nvalidate = ->\r\n  n = slided_cells.length\r\n  if n < 2\r\n    return true\r\n  for i in [0...n - 1]\r\n    current = slided_cells[i]\r\n    next = slided_cells[i + 1]\r\n    current_row = parseInt(current.getAttribute('data-row'))\r\n    current_col = parseInt(current.getAttribute('data-col'))\r\n    next_row = parseInt(next.getAttribute('data-row'))\r\n    next_col = parseInt(next.getAttribute('data-col'))\r\n    if Math.abs(current_row - next_row) + Math.abs(current_col - next_col) != 1\r\n      return false\r\n  return true\r\n\r\nget_node_and_direction = ->\r\n  possible_nodes = [1..(N - 1) * (M - 1)]\r\n  direction = []\r\n  for idx in [0...slided_cells.length]\r\n    cell = slided_cells[idx]\r\n    row = parseInt(cell.getAttribute('data-row'))\r\n    col = parseInt(cell.getAttribute('data-col'))\r\n    if idx > 0\r\n      prev_cell = slided_cells[idx - 1]\r\n      prev_row = parseInt(prev_cell.getAttribute('data-row'))\r\n      prev_col = parseInt(prev_cell.getAttribute('data-col'))\r\n      if prev_row - row == 1\r\n        direction.push('up')\r\n      else if prev_row - row == -1\r\n        direction.push('down')\r\n      else if prev_col - col == 1\r\n        direction.push('left')\r\n      else if prev_col - col == -1\r\n        direction.push('right')\r\n\r\n    current_nodes = []\r\n    for i in [0, -1]\r\n      for j in [0, -1]\r\n        elem = active_nodes_dom.filter((n) -> n.getAttribute('data-row') == \"#{row + i}\" and n.getAttribute('data-col') == \"#{col + j}\")[0]\r\n        if elem\r\n          current_nodes.push(parseInt(elem.getAttribute('data-value')))\r\n    possible_nodes = possible_nodes.filter((v)->current_nodes.indexOf(v) >= 0)\r\n  nn = possible_nodes.length\r\n  if nn == 0\r\n    return false\r\n  if possible_nodes.length == 1\r\n    v = possible_nodes[0]\r\n    if direction.length > 1\r\n      if direction[0] == 'up'\r\n        return [v, direction[1] == 'right']\r\n      if direction[0] == 'down'\r\n        return [v, direction[1] == 'left']\r\n      if direction[0] == 'left'\r\n        return [v, direction[1] == 'up']\r\n      if direction[0] == 'right'\r\n        return [v, direction[1] == 'down']\r\n    else\r\n      return null\r\n  else\r\n    return null\r\n\r\ntable.addEventListener(\"pointerdown\", (e)->\r\n  if not game_completed and not in_demo\r\n    is_sliding = true\r\n    slided_cells = [get_cell(e.target)]\r\n)\r\ntable.addEventListener(\"pointermove\", (e)->\r\n  if is_sliding\r\n    cell = get_cell(document.elementFromPoint(e.clientX, e.clientY))\r\n    if cell\r\n      if slided_cells.indexOf(cell) >= 0\r\n        slided_cells = slided_cells.filter((c)-> c != cell)\r\n        slided_cells.push(cell)\r\n      else\r\n        slided_cells.push(cell)\r\n        slided_cells = slided_cells.slice(-3)\r\n        if validate()\r\n          node_and_direction = get_node_and_direction()\r\n          if node_and_direction != null\r\n            if node_and_direction\r\n              value = node_and_direction[0]\r\n              cw = node_and_direction[1]\r\n              node = active_nodes_dom.filter((n)-> n.getAttribute('data-value') == \"#{value}\" and n.getAttribute(if cw then 'data-cw' else 'data-ccw') == \"true\")[0]\r\n              if node\r\n                row = parseInt(node.getAttribute('data-row'))\r\n                col = parseInt(node.getAttribute('data-col'))\r\n                animate(value, row, col, cw)\r\n            is_sliding = false\r\n            slided_cells = []\r\n        else\r\n          is_sliding = false\r\n          slided_cells = []\r\n)\r\ntable.addEventListener(\"pointerup pointerleave pointercancel\", ->\r\n  is_sliding = false\r\n  slided_cells = []\r\n)\r\n\r\ndocument.addEventListener('keydown', (e)->\r\n  if e.metaKey or e.ctrlKey\r\n    if e.key == 'x' or e.key == 'X'\r\n      if not restart_button.getAttribute('disabled')\r\n        restart_button.click()\r\n\r\n    if e.key == 'z' or e.key == 'Z'\r\n      if not undo_button.getAttribute('disabled')\r\n        undo_button.click()\r\n)\r\n\r\ndocument.getElementById('instructions-toggle').addEventListener('click', ->\r\n  body = document.querySelector('.instructions-body')\r\n  body.style.display = if body.style.display != 'block' then 'block' else 'none'\r\n)"
  ]
}