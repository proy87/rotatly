{
  "version": 3,
  "file": "create.js",
  "sourceRoot": "\\",
  "sources": [
    "create.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "selected_outline = null\r\nselected = {color_icon: null, board_item: null}\r\noutlines_dom = [...document.querySelectorAll('#outlines > .outline-container')]\r\noutline_dom = document.querySelector('#outline > .outline-container')\r\ngame_dom = document.querySelector('#game-container')\r\noutline_hidden_dom = document.querySelector('#outline-hidden > .outline-container')\r\n\r\ncolor_palette_dom = document.getElementById(\"color-palette\")\r\nboard_palette_dom = document.getElementById(\"board-palette\")\r\n\r\ncopy_outline = (src, target, erase_data = false)->\r\n  target.setAttribute('data-index', src.getAttribute('data-index'))\r\n  src_table = src.querySelector('table')\r\n  target_table = target.querySelector('table')\r\n  for i in [0...src_table.rows.length]\r\n    for j in [0...src_table.rows[0].cells.length]\r\n      target_cell = target_table.rows[i].cells[j]\r\n      src_cell = src_table.rows[i].cells[j]\r\n      target_cell.setAttribute('data-value', src_cell.getAttribute('data-value'))\r\n      if erase_data\r\n        remove_data(target_cell, color_palette_dom, 'color-icon', 'color_icon')\r\n  target.querySelector('.outline-grid').innerHTML = src.querySelector('.outline-grid').innerHTML\r\n\r\noutlines_dom.forEach((outline)->\r\n  outline.addEventListener('click', ->\r\n    if selected_outline\r\n      selected_outline.classList.remove('selected')\r\n      if selected_outline == this\r\n        copy_outline(outline_hidden_dom, outline_dom, true)\r\n        copy_outline(outline_hidden_dom, game_dom)\r\n        selected_outline = null\r\n        return\r\n    this.classList.add('selected')\r\n    selected_outline = this\r\n    copy_outline(selected_outline, outline_dom, true)\r\n    copy_outline(selected_outline, game_dom)\r\n  )\r\n)\r\n\r\nitem_click_handler = (property) ->\r\n  if selected[property]\r\n    selected[property].classList.remove('selected')\r\n    if selected[property] == this\r\n      selected[property] = null\r\n      return\r\n  this.classList.add('selected')\r\n  selected[property] = this\r\n\r\n\r\nremove_data = (cell, palette, icon_class, key)->\r\n  color_class = cell.getAttribute('data-class')\r\n  if color_class\r\n    cell.classList.remove(color_class)\r\n    palette.querySelector(\".#{color_class}\").style.display = 'flex'\r\n  cell.removeAttribute('data-class')\r\n  cell.removeAttribute('data-index')\r\n  cell.removeAttribute('data-name')\r\n  span = cell.querySelector('span')\r\n  if span\r\n    span.innerHTML = ''\r\n\r\nset_data = (cell, klass, index, name)->\r\n  cell_color_class = cell.getAttribute('data-class')\r\n  if cell_color_class\r\n    cell.classList.remove(cell_color_class)\r\n  cell.classList.add(klass)\r\n  cell.setAttribute('data-class', klass)\r\n  cell.setAttribute('data-index', index)\r\n  cell.setAttribute('data-name', name)\r\n  if name\r\n    cell.querySelector('span').innerHTML = name\r\n\r\n\r\ninit_handlers = (key, icon_class, dom, palette_dom)->\r\n  if key == 'color_icon'\r\n    for item in palette_dom.getElementsByClassName(icon_class)\r\n      item.addEventListener('click', ->\r\n        item_click_handler.call(this, key)\r\n      )\r\n  dom.querySelectorAll('td').forEach((cell) ->\r\n    cell.addEventListener(\"click\", ->\r\n      value = cell.getAttribute('data-value')\r\n      selected_value = selected[key]\r\n      if selected_value\r\n        cell_color_class = cell.getAttribute('data-class')\r\n        if cell_color_class\r\n          palette_dom.querySelector(\".#{cell_color_class}\").style.display = 'flex'\r\n        klass = selected_value.getAttribute('data-class')\r\n        index = selected_value.getAttribute('data-index')\r\n        name = selected_value.getAttribute('data-name')\r\n        if key == 'color_icon'\r\n          dom.querySelectorAll(\"td[data-value='#{value}']\").forEach((c)->\r\n            set_data(c, klass, index, name)\r\n          )\r\n        else\r\n          set_data(cell, klass, index, name)\r\n\r\n        selected_value.classList.remove('selected')\r\n        if dom.querySelectorAll(\".#{klass}\").length >= 4\r\n          selected_value.style.display = 'none'\r\n        selected[key] = null\r\n      else\r\n        cell_color_class = cell.getAttribute('data-class')\r\n        if cell_color_class\r\n          if key == 'color_icon'\r\n            dom.querySelectorAll(\"td[data-value='#{value}']\").forEach((c)->\r\n              remove_data(c, palette_dom, icon_class, key)\r\n            )\r\n          else\r\n            remove_data(cell, palette_dom, icon_class, key)\r\n    )\r\n  )\r\n\r\nfor [key, icon_class, dom, palette_dom] in [['color_icon', 'color-icon', outline_dom, color_palette_dom],\r\n  ['board_item', 'board-item', game_dom, board_palette_dom]]\r\n  init_handlers(key, icon_class, dom, palette_dom)\r\n\r\ndocument.querySelectorAll('.node').forEach((node)->\r\n  node.addEventListener('click', ->\r\n    node.classList.toggle('disabled')\r\n  )\r\n)\r\n\r\ncreate_clone = (source)->\r\n  clone = source.cloneNode(true)\r\n  clone.style.position = 'absolute'\r\n  clone.style.left = source.offsetLeft + 'px'\r\n  clone.style.top = source.offsetTop + 'px'\r\n  source.before(clone)\r\n  return clone\r\n\r\nactive_item_clone = null\r\ninteract('.board-item').draggable(\r\n  onstart: (evt)->\r\n    active_item_clone = create_clone(evt.target)\r\n  onmove: (evt)->\r\n    el = evt.target\r\n    x = (parseFloat(el.dataset.x) || 0) + evt.dx\r\n    y = (parseFloat(el.dataset.y) || 0) + evt.dy\r\n    el.style.transform = \"translate(#{x}px, #{y}px)\"\r\n    el.dataset.x = x\r\n    el.dataset.y = y\r\n  onend: (evt)->\r\n    el = evt.target\r\n    el.style.transform = ''\r\n    el.removeAttribute('data-x')\r\n    el.removeAttribute('data-y')\r\n    active_item_clone.remove()\r\n    active_item_clone = null\r\n).styleCursor(false)\r\n\r\ninteract('#game-container td').dropzone(\r\n  accept: '.board-item'\r\n  overlap: 0.75,\r\n  ondrop: (evt)->\r\n    el = evt.target\r\n    cell_class = el.getAttribute('data-class')\r\n    if cell_class\r\n      board_palette_dom.querySelector(\".#{cell_class}\").style.display = 'flex'\r\n    selected_value = evt.relatedTarget\r\n    klass = selected_value.getAttribute('data-class')\r\n    index = selected_value.getAttribute('data-index')\r\n    name = selected_value.getAttribute('data-name')\r\n    set_data(el, klass, index, name)\r\n    if game_dom.querySelectorAll(\".#{klass}\").length >= 4\r\n      selected_value.style.display = 'none'\r\n)\r\n\r\ndocument.querySelectorAll('.tetramino').forEach((t)->\r\n  if not t.parentNode.classList.contains('tet-O')\r\n    t.dataset.rotationAngle = 0\r\n    t.addEventListener('click', ->\r\n      if t.dataset.isDragging == 'true'\r\n        t.dataset.isDragging = false\r\n      else\r\n        t.dataset.rotationAngle = parseInt(t.dataset.rotationAngle) + 90\r\n        t.style.setProperty('--rotation', \"#{t.dataset.rotationAngle}deg\")\r\n    )\r\n)\r\noutline_table = document.querySelector('#outline table')\r\nsnap_targets = (index) ->\r\n  inner = (x, y, interaction) ->\r\n    el = interaction.element\r\n    console.log(x - el.style.left,y- el.style.top)\r\n    cell_size = el.querySelector('.cell').getBoundingClientRect().width\r\n    tableRect = outline_table.getBoundingClientRect()\r\n    console.log(tableRect)\r\n    offsetY  = window.pageYOffset or document.documentElement.scrollTop\r\n    offsetX = window.pageXOffset or document.documentElement.scrollLeft\r\n    points  = []\r\n    for i in [0...outline_table.rows.length - 1]\r\n      for j in [0...outline_table.rows[0].cells.length - 1]\r\n        points.push(\r\n          x: tableRect.left + offsetX + (j + 1) * cell_size,\r\n          y: tableRect.top + offsetY + (i + 1) * cell_size\r\n        )\r\n    return points[index]\r\n  return inner\r\ninteract('.tetramino').draggable(\r\n  onstart: (evt)->\r\n    el = evt.target\r\n    el.classList.remove('animate')\r\n    el.dataset.isDragging = true\r\n    active_item_clone = create_clone(el)\r\n  onmove: (evt)->\r\n    el = evt.target\r\n    x = (parseFloat(el.dataset.x) or 0) + evt.dx\r\n    y = (parseFloat(el.dataset.y) or 0) + evt.dy\r\n    el.style.transform = \"translate(#{x}px, #{y}px) rotate(var(--rotation, 0))\"\r\n    el.dataset.x = x\r\n    el.dataset.y = y\r\n  onend: (evt)->\r\n    el = evt.target\r\n    el.style.transform = \"rotate(var(--rotation, 0))\"\r\n    el.removeAttribute('data-x')\r\n    el.removeAttribute('data-y')\r\n    el.offsetHeight\r\n    el.classList.add('animate')\r\n    active_item_clone.remove()\r\n    active_item_clone = null\r\n  modifiers:[\r\n    interact.modifiers.snap(\r\n      targets: (snap_targets(i) for i in [0...9] if snap_targets(i))\r\n      range: 20\r\n      relativePoints: [{ x: 0.5, y: 0.5 }]\r\n    )\r\n  ]\r\n\r\n).styleCursor(false)\r\n\r\ninteract('#outline table').dropzone(\r\n    accept: '.tetramino'\r\n    overlap: 0.8,\r\n    ondrop: (evt) ->\r\n      tetramino = evt.relatedTarget\r\n      cell = evt.target\r\n      cell.parentNode.querySelector('.outline-grid').innerHTML = tetramino.querySelector('.outline-grid').innerHTML\r\n      console.log(cell.getBoundingClientRect())\r\n      console.log(tetramino.getBoundingClientRect())\r\n)"
  ]
}